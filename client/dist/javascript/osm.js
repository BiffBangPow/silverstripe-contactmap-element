(()=>{var i={582:function(t){t.exports=function(){"use strict";function g(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function h(t,e){return t<e?-1:e<t?1:0}function t(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}function _(t,e){m(t,0,t.children.length,e,t)}function m(t,e,i,n,s){(s=s||v(null)).minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r=e;r<i;r++){var o=t.children[r];c(s,t.leaf?n(o):o)}return s}function c(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function r(t,e){return t.minX-e.minX}function o(t,e){return t.minY-e.minY}function p(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function l(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function v(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function x(t,e,i,n,s){for(var r,o,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=n||(r=e+Math.ceil((i-e)/n/2)*n,function t(e,i,n,s,r){for(;n<s;){600<s-n&&(o=s-n+1,a=i-n+1,l=Math.log(o),h=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*h*(o-h)/o)*(a-o/2<0?-1:1),t(e,i,Math.max(n,Math.floor(i-a*h/o+l)),Math.min(s,Math.floor(i+(o-a)*h/o+l)),r));var o,a,h,l,d=e[i],u=n,c=s;for(g(e,n,i),0<r(e[s],d)&&g(e,n,s);u<c;){for(g(e,u,c),u++,c--;r(e[u],d)<0;)u++;for(;0<r(e[c],d);)c--}0===r(e[n],d)?g(e,n,c):g(e,++c,s),c<=i&&(n=c+1),i<=c&&(s=c-1)}}(o=t,r,e||0,i||o.length-1,s||h),a.push(e,r,r,i))}return t.prototype.all=function(){return this._all(this.data,[])},t.prototype.search=function(t){var e=this.data,i=[];if(l(t,e))for(var n=this.toBBox,s=[];e;){for(var r=0;r<e.children.length;r++){var o=e.children[r],a=e.leaf?n(o):o;l(t,a)&&(e.leaf?i.push(o):d(t,a)?this._all(o,i):s.push(o))}e=s.pop()}return i},t.prototype.collides=function(t){var e=this.data;if(l(t,e))for(var i=[];e;){for(var n=0;n<e.children.length;n++){var s=e.children[n],r=e.leaf?this.toBBox(s):s;if(l(t,r)){if(e.leaf||d(t,r))return!0;i.push(s)}}e=i.pop()}return!1},t.prototype.load=function(t){if(t&&t.length)if(t.length<this._minEntries)for(var e=0;e<t.length;e++)this.insert(t[e]);else{var i,n=this._build(t.slice(),0,t.length-1,0);this.data.children.length?this.data.height===n.height?this._splitRoot(this.data,n):(this.data.height<n.height&&(i=this.data,this.data=n,n=i),this._insert(n,this.data.height-n.height-1,!0)):this.data=n}return this},t.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},t.prototype.clear=function(){return this.data=v([]),this},t.prototype.remove=function(t,e){if(t)for(var i,n,s,r=this.data,o=this.toBBox(t),a=[],h=[];r||a.length;){if(r||(r=a.pop(),n=a[a.length-1],i=h.pop(),s=!0),r.leaf){var l=function(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}(t,r.children,e);if(-1!==l)return r.children.splice(l,1),a.push(r),this._condense(a),this}s||r.leaf||!d(r,o)?n?(i++,r=n.children[i],s=!1):r=null:(a.push(r),h.push(i),r=(n=r).children[i=0])}return this},t.prototype.toBBox=function(t){return t},t.prototype.compareMinX=function(t,e){return t.minX-e.minX},t.prototype.compareMinY=function(t,e){return t.minY-e.minY},t.prototype.toJSON=function(){return this.data},t.prototype.fromJSON=function(t){return this.data=t,this},t.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},t.prototype._build=function(t,e,i,n){var s,r=i-e+1,o=this._maxEntries;if(r<=o)_(s=v(t.slice(e,i+1)),this.toBBox);else{n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),(s=v([])).leaf=!1,s.height=n;var a=Math.ceil(r/o),h=a*Math.ceil(Math.sqrt(o));x(t,e,i,h,this.compareMinX);for(var l=e;l<=i;l+=h){var d=Math.min(l+h-1,i);x(t,l,d,a,this.compareMinY);for(var u=l;u<=d;u+=a){var c=Math.min(u+a-1,d);s.children.push(this._build(t,u,c,n-1))}}_(s,this.toBBox)}return s},t.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var s=1/0,r=1/0,o=void 0,a=0;a<e.children.length;a++){var h=e.children[a],l=p(h),d=(u=t,d=h,(Math.max(d.maxX,u.maxX)-Math.min(d.minX,u.minX))*(Math.max(d.maxY,u.maxY)-Math.min(d.minY,u.minY))-l);d<r?(r=d,s=l<s?l:s,o=h):d===r&&l<s&&(s=l,o=h)}e=o||e.children[0]}var u,d;return e},t.prototype._insert=function(t,e,i){var i=i?t:this.toBBox(t),n=[],s=this._chooseSubtree(i,this.data,e,n);for(s.children.push(t),c(s,i);0<=e&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(i,n,e)},t.prototype._split=function(t,e){var i=t[e],n=i.children.length,s=this._minEntries,s=(this._chooseSplitAxis(i,s,n),this._chooseSplitIndex(i,s,n)),n=v(i.children.splice(s,i.children.length-s));n.height=i.height,n.leaf=i.leaf,_(i,this.toBBox),_(n,this.toBBox),e?t[e-1].children.push(n):this._splitRoot(i,n)},t.prototype._splitRoot=function(t,e){this.data=v([t,e]),this.data.height=t.height+1,this.data.leaf=!1,_(this.data,this.toBBox)},t.prototype._chooseSplitIndex=function(t,e,i){for(var n,s,r,o,a=1/0,h=1/0,l=e;l<=i-e;l++){var d=m(t,0,l,this.toBBox),u=m(t,l,i,this.toBBox),c=(o=d,c=u,s=Math.max(o.minX,c.minX),r=Math.max(o.minY,c.minY),g=Math.min(o.maxX,c.maxX),o=Math.min(o.maxY,c.maxY),Math.max(0,g-s)*Math.max(0,o-r)),g=p(d)+p(u);c<a?(a=c,n=l,h=g<h?g:h):c===a&&g<h&&(h=g,n=l)}return n||i-e},t.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:r,s=t.leaf?this.compareMinY:o;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,s)&&t.children.sort(n)},t.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var s=this.toBBox,r=m(t,0,e,s),o=m(t,i-e,i,s),a=f(r)+f(o),h=e;h<i-e;h++){var l=t.children[h];c(r,t.leaf?s(l):l),a+=f(r)}for(var d=i-e-1;e<=d;d--){var u=t.children[d];c(o,t.leaf?s(u):u),a+=f(o)}return a},t.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;0<=n;n--)c(e[n],t)},t.prototype._condense=function(t){for(var e=t.length-1,i=void 0;0<=e;e--)0===t[e].children.length?0<e?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():_(t[e],this.toBBox)},t}()}},n={};function $r(t){var e=n[t];return void 0!==e||(e=n[t]={exports:{}},i[t].call(e.exports,e,e.exports,$r)),e.exports}(()=>{"use strict";const t=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}},I="propertychange",b=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}};function G(t,e){return e<t?1:t<e?-1:0}function M(e,i,n){var s=e.length;if(e[0]<=i)return 0;if(i<=e[s-1])return s-1;{let t;if(0<n){for(t=1;t<s;++t)if(e[t]<i)return t-1}else if(n<0){for(t=1;t<s;++t)if(e[t]<=i)return t}else for(t=1;t<s;++t){if(e[t]==i)return t;if(e[t]<i)return"function"==typeof n?0<n(i,e[t-1],e[t])?t-1:t:e[t-1]-i<i-e[t]?t-1:t}return s-1}}function F(e,t){var i=Array.isArray(t)?t:[t],n=i.length;for(let t=0;t<n;t++)e[e.length]=i[t]}function gt(e,i){var n=e.length;if(n===i.length){for(let t=0;t<n;t++)if(e[t]!==i[t])return;return 1}}function L(){return!0}function P(){return!1}function k(){}function A(t){for(const e in t)delete t[e]}function D(t){let e;for(e in t)return!1;return!e}const O=class extends b{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){var i;t&&e&&((i=(i=this.listeners_||(this.listeners_={}))[t]||(i[t]=[])).includes(e)||i.push(e))}dispatchEvent(e){var n="string"==typeof e,s=n?e:e.type,r=this.listeners_&&this.listeners_[s];if(r){var o=n?new t(e):e,n=(o.target||(o.target=this.eventTarget_||this),this.dispatching_||(this.dispatching_={})),e=this.pendingRemovals_||(this.pendingRemovals_={});let i;s in n||(n[s]=0,e[s]=0),++n[s];for(let t=0,e=r.length;t<e;++t)if(!1===(i="handleEvent"in r[t]?r[t].handleEvent(o):r[t].call(this,o))||o.propagationStopped){i=!1;break}if(0==--n[s]){let t=e[s];for(delete e[s];t--;)this.removeEventListener(s,k);delete n[s]}return i}}disposeInternal(){this.listeners_&&A(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return!!this.listeners_&&(t?t in this.listeners_:0<Object.keys(this.listeners_).length)}removeEventListener(t,e){var i=this.listeners_&&this.listeners_[t];i&&-1!==(e=i.indexOf(e))&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[e]=k,++this.pendingRemovals_[t]):(i.splice(e,1),0===i.length&&delete this.listeners_[t]))}},o="change",B="contextmenu",j="click",Z="keydown",K="keypress",V="touchmove",U="wheel";function r(t,e,i,n,s){if(n&&n!==t&&(i=i.bind(n)),s){const n=i;i=function(){t.removeEventListener(e,i),n.apply(this,arguments)}}n={target:t,type:e,listener:i};return t.addEventListener(e,i),n}function q(t,e,i,n){return r(t,e,i,n,!0)}function a(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),A(t))}class H extends O{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(o)}getRevision(){return this.revision_}onInternal(e,i){if(Array.isArray(e)){var n=e.length,s=new Array(n);for(let t=0;t<n;++t)s[t]=r(this,e[t],i);return s}return r(this,e,i)}onceInternal(e,i){let n;if(Array.isArray(e)){var s=e.length;n=new Array(s);for(let t=0;t<s;++t)n[t]=q(this,e[t],i)}else n=q(this,e,i);return i.ol_key=n}unInternal(i,n){var t=n.ol_key;if(t){var s=t;if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)a(s[t]);else a(s)}else if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)this.removeEventListener(i[t],n);else this.removeEventListener(i,n)}}var J=H;function h(){throw new Error("Unimplemented abstract method.")}let Q=0;function z(t){return t.ol_uid||(t.ol_uid=String(++Q))}class $ extends t{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const e=class extends J{constructor(t){super(),this.on,this.once,this.un,z(this),this.values_=null,void 0!==t&&this.setProperties(t)}get(t){let e;return e=this.values_&&this.values_.hasOwnProperty(t)?this.values_[t]:e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){var i="change:"+t;this.hasListener(i)&&this.dispatchEvent(new $(i,t,e)),i=I,this.hasListener(i)&&this.dispatchEvent(new $(i,t,e))}addChangeListener(t,e){this.addEventListener("change:"+t,e)}removeChangeListener(t,e){this.removeEventListener("change:"+t,e)}set(t,e,i){var n=this.values_||(this.values_={});if(i)n[t]=e;else{const i=n[t];i!==(n[t]=e)&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){var i;this.values_&&t in this.values_&&(i=this.values_[t],delete this.values_[t],D(this.values_)&&(this.values_=null),e||this.notify(t,i))}},tt={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class et extends Error{constructor(t){var e=tt[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}const it=et,nt="add",st="remove";class rt extends t{constructor(t,e,i){super(t),this.element=e,this.index=i}}const l=class extends e{constructor(t,e){if(super(),this.on,this.once,this.un,this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;0<this.getLength();)this.pop()}extend(i){for(let t=0,e=i.length;t<e;++t)this.push(i[t]);return this}forEach(i){var n=this.array_;for(let t=0,e=n.length;t<e;++t)i(n[t],t,n)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get("length")}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new rt(nt,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(i){var n=this.array_;for(let t=0,e=n.length;t<e;++t)if(n[t]===i)return this.removeAt(t)}removeAt(t){var e;if(!(t<0||t>=this.getLength()))return e=this.array_[t],this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new rt(st,e,t)),e}setAt(t,e){if(t>=this.getLength())this.insertAt(t,e);else{if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);var i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new rt(st,i,t)),this.dispatchEvent(new rt(nt,e,t))}}updateLength_(){this.set("length",this.array_.length)}assertUnique_(i,n){for(let t=0,e=this.array_.length;t<e;++t)if(this.array_[t]===i&&t!==n)throw new it(58)}},i="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",ot=i.includes("firefox"),at=(!i.includes("safari")||i.includes("chrom")||i.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(i),i.includes("webkit")&&!i.includes("edge")),ht=i.includes("macintosh"),lt="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,dt="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,ut="undefined"!=typeof Image&&Image.prototype.decode,ct=function(){let t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}return t}();function d(t,e){if(!t)throw new it(e)}function W(t,e){var i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function X(t,e,i,n,s,r,o,a){var h=Math.sin(r),r=Math.cos(r);return t[0]=n*r,t[1]=s*h,t[2]=-n*h,t[3]=s*r,t[4]=o*n*r-a*n*h+e,t[5]=o*s*h+a*s*r+i,t}function pt(t,e){var i=e[0]*e[3]-e[1]*e[2],n=(d(0!=i,32),e[0]),s=e[1],r=e[2],o=e[3],a=e[4],e=e[5];t[0]=o/i,t[1]=-s/i,t[2]=-r/i,t[3]=n/i,t[4]=(r*e-o*a)/i,t[5]=-(n*e-s*a)/i}let ft;function vt(t){var e,t="matrix("+t.join(", ")+")";return dt?t:((e=ft=ft||document.createElement("div")).style.transform=t,e.style.transform)}function xt(i){var n=[1/0,1/0,-1/0,-1/0];for(let t=0,e=i.length;t<e;++t)Mt(n,i[t]);return n}function yt(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Ct(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function St(t,e,i){e=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,i=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0;return e*e+i*i}function wt(t,e){return Tt(t,e[0],e[1])}function Et(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function Tt(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function Rt(t,e){var i=t[0],n=t[1],s=t[2],t=t[3],r=e[0],e=e[1];let o=0;return r<i?o|=16:s<r&&(o|=4),e<n?o|=8:t<e&&(o|=2),o=0===o?1:o}function x(t,e,i,n,s){return s?(s[0]=t,s[1]=e,s[2]=i,s[3]=n,s):[t,e,i,n]}function It(t){return x(1/0,1/0,-1/0,-1/0,t)}function bt(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Mt(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Ft(t,e,i,n,s){for(;i<n;i+=s)r=t,o=e[i],a=e[i+1],r[0]=Math.min(r[0],o),r[1]=Math.min(r[1],a),r[2]=Math.max(r[2],o),r[3]=Math.max(r[3],a);var r,o,a;return t}function Lt(t,e){var i=e(kt(t));return i||e(At(t))||e(Xt(t))||e(Wt(t))}function Pt(t){let e=0;return e=Nt(t)?e:Y(t)*N(t)}function kt(t){return[t[0],t[1]]}function At(t){return[t[2],t[1]]}function Dt(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Ot(t,e,i,n,s){var[t,e,i,n,r,o,a,h]=Gt(t,e,i,n);return x(Math.min(t,i,r,a),Math.min(e,n,o,h),Math.max(t,i,r,a),Math.max(e,n,o,h),s)}function Gt(t,e,i,n){var s=e*n[0]/2,e=e*n[1]/2,n=Math.cos(i),i=Math.sin(i),r=s*n,s=s*i,n=e*n,e=e*i,i=t[0],t=t[1];return[i-r+e,t-s-n,i-r-e,t-s+n,i+r-e,t+s+n,i+r+e,t+s-n,i-r+e,t-s-n]}function N(t){return t[3]-t[1]}function zt(t,e,i){i=i||[1/0,1/0,-1/0,-1/0];return _t(t,e)?(t[0]>e[0]?i[0]=t[0]:i[0]=e[0],t[1]>e[1]?i[1]=t[1]:i[1]=e[1],t[2]<e[2]?i[2]=t[2]:i[2]=e[2],t[3]<e[3]?i[3]=t[3]:i[3]=e[3]):It(i),i}function Wt(t){return[t[0],t[3]]}function Xt(t){return[t[2],t[3]]}function Y(t){return t[2]-t[0]}function _t(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Nt(t){return t[2]<t[0]||t[3]<t[1]}function Yt(t,e){var i=e.getExtent(),n=Dt(t);if(e.canWrapX()&&(n[0]<i[0]||n[0]>=i[2])){const e=Y(i),s=Math.floor((n[0]-i[0])/e)*e;t[0]-=s,t[2]-=s}return t}function E(t,e,i){return Math.min(Math.max(t,e),i)}function Bt(t,e,i,n){i-=t,t=n-e;return i*i+t*t}function jt(t){return t*Math.PI/180}function Zt(t,e){t%=e;return t*e<0?t+e:t}function Kt(t,e,i){return t+i*(e-t)}function Vt(t,e){e=Math.pow(10,e);return Math.round(t*e)/e}function Ut(t,e){return Math.floor(Vt(t,e))}function qt(t,e){return Math.ceil(Vt(t,e))}new Array(6);const Ht=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Jt=/^([a-z]*)$|^hsla?\(.*\)$/i;function Qt(t){return"string"==typeof t?t:ie(t)}const $t=function(){const i={};let n=0;return function(t){let e;if(i.hasOwnProperty(t))e=i[t];else{if(1024<=n){let t=0;for(const e in i)0==(3&t++)&&(delete i[e],--n)}e=function(t){let e,i,n,s,r;var o,a;return Jt.exec(t)&&(t=function(t){var e=document.createElement("div");if(e.style.color=t,""===e.style.color)return"";{document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}}(t)),Ht.exec(t)?(o=(a=t.length-1)<=4?1:2,a=4==a||8==a,e=parseInt(t.substr(1+0*o,o),16),i=parseInt(t.substr(1+o,o),16),n=parseInt(t.substr(1+2*o,o),16),s=a?parseInt(t.substr(1+3*o,o),16):255,1==o&&(e=(e<<4)+e,i=(i<<4)+i,n=(n<<4)+n,a)&&(s=(s<<4)+s),r=[e,i,n,s/255]):t.startsWith("rgba(")?ee(r=t.slice(5,-1).split(",").map(Number)):t.startsWith("rgb(")?((r=t.slice(4,-1).split(",").map(Number)).push(1),ee(r)):d(!1,14),r}(t),i[t]=e,++n}return e}}();function te(t){return Array.isArray(t)?t:$t(t)}function ee(t){t[0]=E(t[0]+.5|0,0,255),t[1]=E(t[1]+.5|0,0,255),t[2]=E(t[2]+.5|0,0,255),t[3]=E(t[3],0,1)}function ie(t){let e=t[0],i=(e!=(0|e)&&(e=e+.5|0),t[1]),n=(i!=(0|i)&&(i=i+.5|0),t[2]);return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+i+","+n+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function ne(t,e,i){return e+":"+t+":"+(i?Qt(i):"null")}const se=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const i in this.cache_){var e=this.cache_[i];0!=(3&t++)||e.hasListener()||(delete this.cache_[i],--this.cacheSize_)}}}get(t,e,i){t=ne(t,e,i);return t in this.cache_?this.cache_[t]:null}set(t,e,i,n){t=ne(t,e,i);this.cache_[t]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}},re="opacity",oe="visible",ae="maxResolution",he="minResolution",le="maxZoom",de="minZoom",ue="source",ce=class extends e{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;var e=Object.assign({},t);"object"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e.opacity=void 0!==t.opacity?t.opacity:1,d("number"==typeof e.opacity,64),e.visible=void 0===t.visible||t.visible,e.zIndex=t.zIndex,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,e.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,e.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){var t=this.state_||{layer:this,managed:void 0===t||t},e=this.getZIndex();return t.opacity=E(Math.round(100*this.getOpacity())/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=void 0!==e||t.managed?e:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t}getLayersArray(t){return h()}getLayerStatesArray(t){return h()}getExtent(){return this.get("extent")}getMaxResolution(){return this.get(ae)}getMinResolution(){return this.get(he)}getMinZoom(){return this.get(de)}getMaxZoom(){return this.get(le)}getOpacity(){return this.get(re)}getSourceState(){return h()}getVisible(){return this.get(oe)}getZIndex(){return this.get("zIndex")}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set("extent",t)}setMaxResolution(t){this.set(ae,t)}setMinResolution(t){this.set(he,t)}setMaxZoom(t){this.set(le,t)}setMinZoom(t){this.set(de,t)}setOpacity(t){d("number"==typeof t,64),this.set(re,t)}setVisible(t){this.set(oe,t)}setZIndex(t){this.set("zIndex",t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},ge="precompose",_e="rendercomplete";function me(t,e){if(t.visible){var i=e.resolution;if(!(i<t.minResolution||i>=t.maxResolution))return(i=e.zoom)>t.minZoom&&i<=t.maxZoom}}const pe=class extends ce{constructor(t){var e=Object.assign({},t),e=(delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ue,this.handleSourcePropertyChange_),t.source||null);this.setSource(e)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(ue)||null}getRenderSource(){return this.getSource()}getSourceState(){var t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(a(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=r(t,o,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(t=>t([]))}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}render(t,e){var i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set("map",t)}getMapInternal(){return this.get("map")}setMap(t){this.mapPrecomposeKey_&&(a(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(a(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=r(t,ge,function(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);d(!e.some(function(t){return t.layer===i.layer}),67),e.push(i)},this),this.mapRenderKey_=r(this,o,t.render,t),this.changed())}setSource(t){this.set(ue,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function fe(e,i){let n=!0;for(let t=e.length-1;0<=t;--t)if(e[t]!=i[t]){n=!1;break}return n}function ve(t,e){var i=Math.cos(e),e=Math.sin(e),n=t[0]*i-t[1]*e,i=t[1]*i+t[0]*e;t[0]=n,t[1]=i}function xe(t,e){var i;return e.canWrapX()&&(i=Y(e.getExtent()),e=function(t,e,i){var n=e.getExtent();let s=0;return e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])&&(i=i||Y(n),s=Math.floor((t[0]-n[0])/i)),s}(t,e,i))&&(t[0]-=e*i),t}function ye(t,e){se.expire()}function Ce(t){var i=t.match(Re);if(!i)return null;var n={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let t=0,e=Ie.length;t<e;++t){var s=i[t+1];void 0!==s&&(n[Ie[t]]=s)}return n.families=n.family.split(/,\s?/),n}const Se=class extends b{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){h()}calculateMatrices2D(t){var e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;X(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),pt(n,i)}forEachFeatureAtCoordinate(i,n,s,t,r,o,a,h){let l;const d=n.viewState;function u(t,e,i,n){return r.call(o,e,t?i:null,n)}const c=d.projection,g=xe(i.slice(),c),_=[[0,0]];if(c.canWrapX()&&t){const i=Y(c.getExtent());_.push([-i,0],[i,0])}var m=n.layerStatesArray,p=m.length,f=[],v=[];for(let e=0;e<_.length;e++)for(let t=p-1;0<=t;--t){const o=m[t],c=o.layer;if(c.hasRenderer()&&me(o,d)&&a.call(h,c)){const r=c.getRenderer(),a=c.getSource();if(r&&a){const h=a.getWrapX()?g:i,d=u.bind(null,o.managed);v[0]=h[0]+_[e][0],v[1]=h[1]+_[e][1],l=r.forEachFeatureAtCoordinate(v,n,s,d,f)}if(l)return l}}if(0!==f.length){const x=1/f.length;return f.forEach((t,e)=>t.distanceSq+=e*x),f.sort((t,e)=>t.distanceSq-e.distanceSq),f.some(t=>l=t.callback(t.feature,t.layer,t.geometry)),l}}hasFeatureAtCoordinate(t,e,i,n,s,r){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,n,L,this,s,r)}getMap(){return this.map_}renderFrame(t){h()}scheduleExpireIconCache(t){se.canExpireCache()&&t.postRenderFunctions.push(ye)}},we=class extends t{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}},Ee="ol-hidden",Te="ol-control",Re=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),Ie=["style","variant","weight","size","lineHeight","family"];function w(t,e,i,n){i=i&&i.length?i.shift():dt?new OffscreenCanvas(t||300,e||300):document.createElement("canvas");return t&&(i.width=t),e&&(i.height=e),i.getContext("2d",n)}function be(t){var e=t.canvas;e.width=1,e.height=1,t.clearRect(0,0,1,1)}function Me(t,e){var i=e.parentNode;i&&i.replaceChild(t,e)}function Fe(t){t&&t.parentNode&&t.parentNode.removeChild(t)}const Le="10px sans-serif",m="#000",Pe="round",ke=[],Ae="round",De="#000",Oe="center",Ge="middle",ze=[0,0,0,0],c=new e;let We,Xe=null;const Ne={},Ye=function(){const r=["monospace","serif"],o=r.length,a="wmytzilWMYTZIL@#/&?$%10";let h,l;function d(e,i,n){let s=!0;for(let t=0;t<o;++t){const o=r[t];if(l=Ze(e+" "+i+" 32px "+o,a),n!=o){const r=Ze(e+" "+i+" 32px "+n+","+o,a);s=s&&r!=l}}return!!s}function u(){let i=!0;var n=c.getKeys();for(let t=0,e=n.length;t<e;++t){var s=n[t];c.get(s)<100&&(d.apply(this,s.split("\n"))?(A(Ne),Xe=null,We=void 0,c.set(s,100)):(c.set(s,c.get(s)+1,!0),i=!1))}i&&(clearInterval(h),h=void 0)}return function(t){var i=Ce(t);if(i){var n=i.families;for(let t=0,e=n.length;t<e;++t){var s=n[t],r=i.style+"\n"+i.weight+"\n"+s;void 0===c.get(r)&&(c.set(r,100,!0),d(i.style,i.weight,s)||(c.set(r,0,!0),void 0===h&&(h=setInterval(u,32))))}}}}(),Be=function(){let n;return function(t){let e=Ne[t];if(null==e){if(dt){const n=Ce(t),i=je(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else n||((n=document.createElement("div")).innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);Ne[t]=e}return e}}();function je(t,e){return Xe=Xe||w(1,1),t!=We&&(Xe.font=t,We=Xe.font),Xe.measureText(e)}function Ze(t,e){return je(t,e).width}function Ke(i,t,e){var n;return t in e?e[t]:(n=t.split("\n").reduce((t,e)=>Math.max(t,Ze(i,e)),0),e[t]=n)}const Ve=class extends Se{constructor(t){super(t),this.fontChangeListenerKey_=r(c,I,t.redrawText.bind(t)),this.element_=document.createElement("div");var e=this.element_.style,e=(e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className="ol-unselectable ol-layers",t.getViewport());e.insertBefore(this.element_,e.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){var i=this.getMap();i.hasListener(t)&&(t=new we(t,void 0,e),i.dispatchEvent(t))}disposeInternal(){a(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(n){if(n){this.calculateMatrices2D(n),this.dispatchRenderEvent(ge,n);var s=n.layerStatesArray.sort(function(t,e){return t.zIndex-e.zIndex}),r=n.viewState,o=[];let i=null;for(let t=this.children_.length=0,e=s.length;t<e;++t){var a=s[t],h=(n.layerIndex=t,a.layer),l=h.getSourceState();!me(a,r)||"ready"!=l&&"undefined"!=l?h.unrender():(a=h.render(n,i))&&(a!==i&&(this.children_.push(a),i=a),"getDeclutter"in h)&&o.push(h)}for(let t=o.length-1;0<=t;--t)o[t].renderDeclutter(n);var e=this.element_,d=this.children_,u=e.childNodes;for(let t=0;;++t){var c=u[t],g=d[t];if(!c&&!g)break;c!==g&&(c?g?e.insertBefore(g,c):(e.removeChild(c),--t):e.appendChild(g))}this.dispatchRenderEvent("postcompose",n),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(n)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)}};class s extends t{constructor(t,e){super(t),this.layer=e}}const Ue="layers";const qe=class Yr extends ce{constructor(t){t=t||{};var e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ue,this.handleLayersChanged_),i?Array.isArray(i)?i=new l(i.slice(),{unique:!0}):d("function"==typeof i.getArray,43):i=new l(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(a),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(r(t,nt,this.handleLayersAdd_,this),r(t,st,this.handleLayersRemove_,this));for(const t in this.listenerKeys_)this.listenerKeys_[t].forEach(a);A(this.listenerKeys_);var i=t.getArray();for(let t=0,e=i.length;t<e;t++){var n=i[t];this.registerLayerListeners_(n),this.dispatchEvent(new s("addlayer",n))}this.changed()}registerLayerListeners_(t){var e=[r(t,I,this.handleLayerChange_,this),r(t,o,this.handleLayerChange_,this)];t instanceof Yr&&e.push(r(t,"addlayer",this.handleLayerGroupAdd_,this),r(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[z(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new s("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new s("removelayer",t.layer))}handleLayersAdd_(t){t=t.element,this.registerLayerListeners_(t),this.dispatchEvent(new s("addlayer",t)),this.changed()}handleLayersRemove_(t){var e=z(t=t.element);this.listenerKeys_[e].forEach(a),delete this.listenerKeys_[e],this.dispatchEvent(new s("removelayer",t)),this.changed()}getLayers(){return this.get(Ue)}setLayers(i){var t=this.getLayers();if(t){const i=t.getArray();for(let t=0,e=i.length;t<e;++t)this.dispatchEvent(new s("removelayer",i[t]))}this.set(Ue,i)}getLayersArray(e){return e=void 0!==e?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(t){const i=void 0!==t?t:[],n=i.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(i)});var s=this.getLayerState();let r=s.zIndex;t||void 0!==s.zIndex||(r=0);for(let t=n,e=i.length;t<e;t++){const n=i[t];n.opacity*=s.opacity,n.visible=n.visible&&s.visible,n.maxResolution=Math.min(n.maxResolution,s.maxResolution),n.minResolution=Math.max(n.minResolution,s.minResolution),n.minZoom=Math.max(n.minZoom,s.minZoom),n.maxZoom=Math.min(n.maxZoom,s.maxZoom),void 0!==s.extent&&(void 0!==n.extent?n.extent=zt(n.extent,s.extent):n.extent=s.extent),void 0===n.zIndex&&(n.zIndex=r)}return i}getSourceState(){return"ready"}},He=class extends t{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},n=class extends He{constructor(t,e,i,n,s,r){super(t,e,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==n&&n,this.activePointers=r}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},u={SINGLECLICK:"singleclick",CLICK:j,DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Je="pointerdown",Qe=class extends O{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;t=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=t,this.pointerdownListenerKey_=r(t,Je,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=r(t,"pointermove",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(V,this.boundHandleTouchMove_,!!ct&&{passive:!1})}emulateClick_(e){var t=new n(u.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new n(u.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var t=new n(u.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)}updateActivePointers_(t){var e=t,t=e.pointerId;if(e.type==u.POINTERUP||e.type==u.POINTERCANCEL){delete this.trackedTouches_[t];for(const t in this.trackedTouches_)if(this.trackedTouches_[t].target!==e.target){delete this.trackedTouches_[t];break}}else e.type!=u.POINTERDOWN&&e.type!=u.POINTERMOVE||(this.trackedTouches_[t]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);var e=new n(u.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(a),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new n(u.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const e in t){var i=t[e];this.down_[e]="function"==typeof i?k:i}if(0===this.dragListenerKeys_.length){const t=this.map_.getOwnerDocument();this.dragListenerKeys_.push(r(t,u.POINTERMOVE,this.handlePointerMove_,this),r(t,u.POINTERUP,this.handlePointerUp_,this),r(this.element_,u.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==t&&this.dragListenerKeys_.push(r(this.element_.getRootNode(),u.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){this.isMoving_(t)&&(this.updateActivePointers_(t),this.dragging_=!0,t=new n(u.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_),this.dispatchEvent(t))}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new n(u.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){var e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(a(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(V,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(a(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(a),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},$e="postrender",ti="loadstart",ei="loadend",ii="layergroup",ni="size",si="target",ri="view",oi=class extends class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,A(this.queuedElements_)}dequeue(){var t=this.elements_,e=this.priorities_,i=t[0],t=(1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0)),this.keyFunction_(i));return delete this.queuedElements_[t],i}enqueue(t){d(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=1/0&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;0<=t;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,s=e[t],r=i[t],o=t;for(;t<n>>1;){const s=this.getLeftChildIndex_(t),r=this.getRightChildIndex_(t),o=r<n&&i[r]<i[s]?r:s;e[t]=e[o],i[t]=i[o],t=o}e[t]=s,i[t]=r,this.siftDown_(o,t)}siftDown_(t,e){for(var i=this.elements_,n=this.priorities_,s=i[e],r=n[e];t<e;){const t=this.getParentIndex_(e);if(!(n[t]>r))break;i[e]=i[t],n[e]=n[t],e=t}i[e]=s,n[e]=r}reprioritize(){var t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;var s=e.length;let r,o,a;for(o=0;o<s;++o)(a=t(r=e[o]))==1/0?delete this.queuedElements_[this.keyFunction_(r)]:(i[n]=a,e[n++]=r);e.length=n,i.length=n,this.heapify_()}}{constructor(e,t){super(function(t){return e.apply(null,t)},function(t){return t[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){var e=super.enqueue(t);return e&&t[0].addEventListener(o,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){var e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener(o,this.boundHandleTileChange_);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i,n,s=0;for(;this.tilesLoading_<t&&s<e&&0<this.getCount();)n=(i=this.dequeue()[0]).getKey(),0!==i.getState()||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++s,i.load())}},g={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},ai={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937},hi=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ai[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},li=6378137,di=Math.PI*li,ui=[-di,-di,di,di],ci=[-180,-85,180,85],gi=li*Math.log(Math.tan(Math.PI/2));class _i extends hi{constructor(t){super({code:t,units:"m",extent:ui,global:!0,worldExtent:ci,getPointResolution:function(t,e){return t/Math.cosh(e[1]/li)}})}}var _=[new _i("EPSG:3857"),new _i("EPSG:102100"),new _i("EPSG:102113"),new _i("EPSG:900913"),new _i("http://www.opengis.net/def/crs/EPSG/0/3857"),new _i("http://www.opengis.net/gml/srs/epsg.xml#3857")];const mi=[-180,-90,180,90],pi=6378137*Math.PI/180;class fi extends hi{constructor(t,e){super({code:t,units:"degrees",extent:mi,axisOrientation:e,global:!0,metersPerUnit:pi,worldExtent:mi})}}var vi,xi,yi,p=[new fi("CRS:84"),new fi("EPSG:4326","neu"),new fi("urn:ogc:def:crs:OGC:1.3:CRS84"),new fi("urn:ogc:def:crs:OGC:2:84"),new fi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new fi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new fi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ci={},Si={};function wi(t,e,i){t=t.getCode(),e=e.getCode();t in Si||(Si[t]={}),Si[t][e]=i}function Ei(t,e,i){i=i||6371008.8;var n=jt(t[1]),s=jt(e[1]),r=(s-n)/2,e=jt(e[0]-t[0])/2,t=Math.sin(r)*Math.sin(r)+Math.sin(e)*Math.sin(e)*Math.cos(n)*Math.cos(s);return 2*i*Math.atan2(Math.sqrt(t),Math.sqrt(1-t))}let Ti=!0;function Ri(t){Ti=!(void 0===t||t)}function Ii(i,n,t){if(void 0!==n)for(let t=0,e=i.length;t<e;++t)n[t]=i[t];else n=i.slice();return n}function bi(i,n,t){if(void 0!==n&&i!==n){for(let t=0,e=i.length;t<e;++t)n[t]=i[t];i=n}return i}function Mi(t){var e,i;e=t.getCode(),i=t,Ci[e]=i,wi(t,t,Ii)}function f(t){return"string"==typeof t?Ci[e=t]||Ci[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Fi(t,e,i,n){let s;const r=(t=f(t)).getPointResolutionFunc();if(r){if(s=r(e,i),n&&n!==t.getUnits()){const e=t.getMetersPerUnit();e&&(s=s*e/ai[n])}}else{const r=t.getUnits();var o;"degrees"==r&&!n||"degrees"==n?s=e:(o=Ai(t,f("EPSG:4326")),s=o===bi&&"degrees"!==r?e*t.getMetersPerUnit():(Ei((o=o(o=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2],o,2)).slice(0,2),o.slice(2,4))+Ei(o.slice(4,6),o.slice(6,8)))/2,void 0!==(i=n?ai[n]:t.getMetersPerUnit())&&(s/=i))}return s}function Li(t){t.forEach(Mi),t.forEach(function(e){t.forEach(function(t){e!==t&&wi(e,t,Ii)})})}function Pi(t,e){return t?"string"==typeof t?f(t):t:f(e)}function ki(t,e){var i;return t===e||(i=t.getUnits()===e.getUnits(),(t.getCode()===e.getCode()||Ai(t,e)===Ii)&&i)}function Ai(t,e){let i=function(t,e){let i;return i=t in Si&&e in Si[t]?Si[t][e]:i}(t.getCode(),e.getCode());return i=i||bi}function Di(t,e){return Ai(f(t),f(e))}function Oi(t,e,i){return Di(e,i)(t,void 0,t.length)}function Gi(t){return t}function v(t){return Ti&&!fe(t,[0,0])&&-180<=t[0]&&t[0]<=180&&-90<=t[1]&&t[1]<=90&&(Ti=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),t}function zi(t){return t}function Wi(t){return t}function Xi(g,_,m){return function(o,a,h,l,d){if(o){if(!a&&!_)return o;var u=_?0:h[0]*a,h=_?0:h[1]*a,c=d?d[0]:0,d=d?d[1]:0;let t=g[0]+u/2+c,e=g[2]-u/2+c,i=g[1]+h/2+d,n=g[3]-h/2+d,s=(t>e&&(t=(e+t)/2,e=t),i>n&&(i=(n+i)/2,n=i),E(o[0],t,e)),r=E(o[1],i,n);if(l&&m&&a){const g=30*a;s+=-g*Math.log(1+Math.max(0,t-o[0])/g)+g*Math.log(1+Math.max(0,o[0]-e)/g),r+=-g*Math.log(1+Math.max(0,i-o[1])/g)+g*Math.log(1+Math.max(0,o[1]-n)/g)}return[s,r]}}}function Ni(t){return t}function Yi(t,e,i,n){var s=Y(e)/i[0],e=N(e)/i[1];return n?Math.min(t,Math.max(s,e)):Math.min(t,Math.min(s,e))}function Bi(t,e,i){let n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/t-1))/50+1),E(n,i/2,2*e)}function ji(s,r,o,a,h){return o=void 0===o||o,function(t,e,i,n){if(void 0!==t){const e=a?Yi(s,a,i,h):s;return o&&n?Bi(t,e,r):E(t,r,e)}}}function Zi(t){return void 0!==t?0:void 0}function Ki(t){return void 0!==t?t:void 0}function Vi(t){return Math.pow(t,3)}function Ui(t){return 1-Vi(1-t)}function qi(t){return 3*t*t-2*t*t*t}function Hi(t){return t}function Ji(e,i,n,s,r,o){o=o||[];let a=0;for(let t=i;t<n;t+=s){const i=e[t],n=e[t+1];o[a++]=r[0]*i+r[2]*n+r[4],o[a++]=r[1]*i+r[3]*n+r[5]}return o&&o.length!=a&&(o.length=a),o}function Qi(i,t,n,s,e,r,o){o=o||[];var a=Math.cos(e),h=Math.sin(e),l=r[0],d=r[1];let u=0;for(let e=t;e<n;e+=s){const t=i[e]-l,n=i[e+1]-d;o[u++]=l+t*a-n*h,o[u++]=d+t*h+n*a;for(let t=e+2;t<e+s;++t)o[u++]=i[t]}o&&o.length!=u&&(o.length=u)}Li(_),Li(p),vi=_,xi=function(i,n,t){var s=i.length;t=1<t?t:2,void 0===n&&(n=2<t?i.slice():new Array(s));for(let e=0;e<s;e+=t){n[e]=di*i[e]/180;let t=li*Math.log(Math.tan(Math.PI*(+i[e+1]+90)/360));t>gi?t=gi:t<-gi&&(t=-gi),n[e+1]=t}return n},yi=function(e,i,n){var s=e.length;n=1<n?n:2,void 0===i&&(i=2<n?e.slice():new Array(s));for(let t=0;t<s;t+=n)i[t]=180*e[t]/di,i[t+1]=360*Math.atan(Math.exp(e[t+1]/li))/Math.PI-90;return i},p.forEach(function(e){vi.forEach(function(t){wi(e,t,xi),wi(t,e,yi)})});const $i=[1,0,0,1,0,0],tn=class extends e{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(){let e,i,n,s=!1;return function(){var t=Array.prototype.slice.call(arguments);return s&&this===n&&gt(t,i)||(s=!0,n=this,i=t,e=function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)}.apply(this,arguments)),e}}()}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return h()}closestPointXY(t,e,i,n){return h()}containsXY(t,e){var i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return this.closestPointXY(t[0],t[1],e=e||[NaN,NaN],1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return h()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&It(t),this.extentRevision_=this.getRevision()}return e=this.extent_,(t=t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e;var e}rotate(t,e){h()}scale(t,e,i){h()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return h()}getType(){return h()}applyTransform(t){h()}intersectsExtent(t){return h()}translate(t,e){h()}transform(t,r){const o=f(t),e="tile-pixels"==o.getUnits()?function(t,e,i){var n=o.getExtent(),s=o.getWorldExtent(),n=N(s)/N(n);return X($i,s[0],s[3],n,-n,0,0,0),Ji(t,0,t.length,i,$i,e),Di(o,r)(t,e,i)}:Di(o,r);return this.applyTransform(e),this}};function en(t){let e;return"XY"==t?e=2:"XYZ"==t||"XYM"==t?e=3:"XYZM"==t&&(e=4),e}_=class extends tn{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return e=this.flatCoordinates,i=this.flatCoordinates.length,n=this.stride,Ft(It(t),e,0,i,n);var e,i,n}getCoordinates(){return h()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){var e;return this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance?this:(e=this.getSimplifiedGeometryInternal(t)).getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=en(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){h()}setLayout(t,e,i){let n;if(t)n=en(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}t=function(t){let e;return 2==t?e="XY":3==t?e="XYZ":4==t&&(e="XYZM"),e}(n=e.length)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){var i,n=this.getFlatCoordinates();n&&(i=this.getStride(),Qi(n,0,n.length,i,t,e,n),this.changed())}scale(t,e,n){void 0===e&&(e=t),n=n||Dt(this.getExtent());var s=this.getFlatCoordinates();if(s){var r=this.getStride();{var o=s;var a=s.length;var h=r;var l=t;var d=e;var u=n;var c=s;c=c||[];var g=u[0],_=u[1];let i=0;for(let e=0;e<a;e+=h){const a=o[e]-g,u=o[e+1]-_;c[i++]=g+l*a,c[i++]=_+d*u;for(let t=e+2;t<e+h;++t)c[i++]=o[t]}c&&c.length!=i&&(c.length=i)}this.changed()}}translate(t,e){var n=this.getFlatCoordinates();if(n){var s=this.getStride();{var r=n;var o=n.length;var a=s;var h=t;var l=e;var d=n;d=d||[];let i=0;for(let e=0;e<o;e+=a){d[i++]=r[e]+h,d[i++]=r[e+1]+l;for(let t=e+2;t<e+a;++t)d[i++]=r[t]}d&&d.length!=i&&(d.length=i)}this.changed()}}};function nn(e,i,n,s,t,r,o){var a=e[i],h=e[i+1],l=e[n]-a,d=e[n+1]-h;let u;if(0==l&&0==d)u=i;else{var c=((t-a)*l+(r-h)*d)/(l*l+d*d);if(1<c)u=n;else{if(0<c){for(let t=0;t<s;++t)o[t]=Kt(e[i+t],e[n+t],c);return o.length=s}u=i}}for(let t=0;t<s;++t)o[t]=e[u+t];o.length=s}function sn(t,e,i,n,s){let r=t[e],o=t[e+1];for(e+=n;e<i;e+=n){const i=t[e],n=t[e+1],a=Bt(r,o,i,n);s<a&&(s=a),r=i,o=n}return s}function rn(n,s,r,o,a,h,l,d,u,c,g){if(s!=r){let e,i;if(0===a){if((i=Bt(l,d,n[s],n[s+1]))<c){for(e=0;e<o;++e)u[e]=n[s+e];return u.length=o,i}}else{g=g||[NaN,NaN];let t=s+o;for(;t<r;)if(nn(n,t-o,t,o,l,d,g),(i=Bt(l,d,g[0],g[1]))<c){for(c=i,e=0;e<o;++e)u[e]=g[e];u.length=o,t+=o}else t+=o*Math.max((Math.sqrt(i)-Math.sqrt(c))/a|0,1);if(h&&(nn(n,r-o,s,o,l,d,g),(i=Bt(l,d,g[0],g[1]))<c)){for(c=i,e=0;e<o;++e)u[e]=g[e];u.length=o}}}return c}function on(i,n,s,r){for(let t=0,e=s.length;t<e;++t){var o=s[t];for(let t=0;t<r;++t)i[n++]=o[t]}return n}function an(t,e){return e*Math.round(t/e)}function hn(e,i,n,s,r){r=void 0!==r?r:[];let o=0;for(let t=i;t<n;t+=s)r[o++]=e.slice(t,t+s);return r.length=o,r}function ln(i,n,s,r,o){o=void 0!==o?o:[];let a=0;for(let t=0,e=s.length;t<e;++t){var h=s[t];o[a++]=hn(i,n,h,r,o[a]),n=h}return o.length=a,o}function dn(i,n,s,r,o){o=void 0!==o?o:[];let a=0;for(let t=0,e=s.length;t<e;++t){var h=s[t];o[a++]=1===h.length&&h[0]===n?[]:ln(i,n,h,r,o[a]),n=h[h.length-1]}return o.length=a,o}function un(t,e,i,n){let s=0,r=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];s+=o*i-r*n,r=i,o=n}return s/2}const cn=class Br extends _{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new Br(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<St(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(sn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return un(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return hn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){var e=[];return e.length=function(n,s,r,o,t,a,e){const h=(r-s)/o;if(h<3)for(;s<r;s+=o)a[e++]=n[s],a[e++]=n[s+1];else{var l,d,u,c,g,_,m,p,f,v=new Array(h),x=(v[0]=1,v[h-1]=1,[s,r-o]);let i=0;for(;0<x.length;){const r=x.pop(),a=x.pop();let e=0;const h=n[a],y=n[a+1],C=n[r],S=n[r+1];for(let t=a+o;t<r;t+=o){l=n[t],d=n[t+1],u=h,f=p=m=void 0,f=(_=S)-(c=y),0==(p=(g=C)-u)&&0==f||(1<(m=((l-u)*p+(d-c)*f)/(p*p+f*f))?(u=g,c=_):0<m&&(u+=p*m,c+=f*m));const r=Bt(l,d,u,c);r>e&&(i=t,e=r)}e>t&&(v[(i-s)/o]=1,a+o<i&&x.push(a,i),i+o<r)&&x.push(i,r)}for(let t=0;t<h;++t)v[t]&&(a[e++]=n[s+t*o],a[e++]=n[s+t*o+1])}return e}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Br(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=on(this.flatCoordinates,0,t,this.stride),this.changed()}};const gn=class jr extends _{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){var t=new jr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(e,t,i,n){var s=this.flatCoordinates;if((t=Bt(e,t,s[0],s[1]))<n){const e=this.stride;for(let t=0;t<e;++t)i[t]=s[t];return i.length=e,t}return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return e=this.flatCoordinates,i=e[0],e=e[1],x(i,e,i,e,t);var e,i}getType(){return"Point"}intersectsExtent(t){return Tt(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(i,n,s){for(let t=0,e=s.length;t<e;++t)i[n++]=s[t];return n}(this.flatCoordinates,0,t,this.stride),this.changed()}};function _n(t,e,i,n,s,r){let o=0,a=t[i-n],h=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];h<=r?n>r&&0<(i-a)*(r-h)-(s-a)*(n-h)&&o++:n<=r&&(i-a)*(r-h)-(s-a)*(n-h)<0&&o--,a=i,h=n}return 0!==o}function mn(i,t,n,s,r,o){if(0===n.length)return!1;if(!_n(i,t,n[0],s,r,o))return!1;for(let t=1,e=n.length;t<e;++t)if(_n(i,n[t-1],n[t],s,r,o))return!1;return!0}function pn(t,e,i,n,o){var s=Ft([1/0,1/0,-1/0,-1/0],t,e,i,n);return _t(o,s)&&(Et(o,s)||s[0]>=o[0]&&s[2]<=o[2]||s[1]>=o[1]&&s[3]<=o[3]||function(t,e,i,n){var s,r;for(e+=n;e<i;e+=n)if(s=t.slice(e-n,e),r=t.slice(e,e+n),s=function(i,n,s){let r=!1;var o=Rt(i,n),a=Rt(i,s);if(1===o||1===a)r=!0;else{var h=i[0],l=i[1],d=i[2],i=i[3],u=n[0],n=n[1],c=s[0],s=s[1],n=(s-n)/(c-u);let t,e;2&a&&!(2&o)&&(t=c-(s-i)/n,r=t>=h&&t<=d),r||!(4&a)||4&o||(e=s-(c-d)*n,r=e>=l&&e<=i),r||!(8&a)||8&o||(t=c-(s-l)/n,r=t>=h&&t<=d),r||!(16&a)||16&o||(e=s-(c-h)*n,r=e>=l&&e<=i)}return r}(o,s,r))return s}(t,e,i,n))}function fn(t,e,i,n,s){return!!(pn(t,e,i,n,s)||_n(t,e,i,n,s[0],s[1])||_n(t,e,i,n,s[0],s[3])||_n(t,e,i,n,s[2],s[1])||_n(t,e,i,n,s[2],s[3]))}function vn(t,e,i,n){let s=0,r=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];s+=(i-r)*(n+o),r=i,o=n}return 0===s?void 0:0<s}function xn(i,n,s,r,o){o=void 0!==o&&o;for(let t=0,e=s.length;t<e;++t){var a=s[t],h=vn(i,n,a,r);if(0===t?o&&h||!o&&!h:o&&!h||!o&&h){l=void 0;d=void 0;u=void 0;c=void 0;g=void 0;var l=i;var d=n;var u=a;var c=r;for(;d<u-c;){for(let t=0;t<c;++t){var g=l[d+t];l[d+t]=l[u-c+t],l[u-c+t]=g}d+=c,u-=c}}n=a}return n}class yn extends _{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?F(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){var t=new yn(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<St(this.getExtent(),t,e))return n;this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(i,n,s,r,o){for(let t=0,e=s.length;t<e;++t){var a=s[t];o=sn(i,n,a,r,o),n=a}return o}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision());var s=this.flatCoordinates,r=0,o=this.ends_,a=this.stride,h=this.maxDelta_,l=t,d=e,u=i,c=n,g=void 0;g=[NaN,NaN];for(let t=0,e=o.length;t<e;++t){var _=o[t];c=rn(s,r,_,a,h,!0,l,d,u,c,g),r=_}return c}containsXY(t,e){return mn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){{var n=this.getOrientedFlatCoordinates(),s=0,r=this.ends_,o=this.stride;let i=0;for(let t=0,e=r.length;t<e;++t){var a=r[t];i+=un(n,s,a,o),s=a}return i}}getCoordinates(t){let e;return void 0!==t?xn(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,ln(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){var t;return this.flatInteriorPointRevision_!=this.getRevision()&&(t=Dt(this.getExtent()),this.flatInteriorPoint_=function(i,n,s,r){let o,t,a,h,l,d,u;var c=r[1],g=[];for(let t=0,e=n.length;t<e;++t){const r=n[t];for(h=i[r-s],d=i[r-s+1],o=0;o<r;o+=s)l=i[o],u=i[o+1],(c<=d&&u<=c||d<=c&&c<=u)&&(a=(c-d)/(u-d)*(l-h)+h,g.push(a)),h=l,d=u}let e=NaN,_=-1/0;for(g.sort(G),h=g[0],o=1,t=g.length;o<t;++o){l=g[o];const G=Math.abs(l-h);G>_&&mn(i,0,n,s,a=(h+l)/2,c)&&(e=a,_=G),h=l}return[e=isNaN(e)?r[0]:e,c,_]}(this.getOrientedFlatCoordinates(),this.ends_,this.stride,t),this.flatInteriorPointRevision_=this.getRevision()),this.flatInteriorPoint_}getInteriorPoint(){return new gn(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new cn(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){var i=this.layout,n=this.flatCoordinates,s=this.ends_,r=[];let o=0;for(let t=0,e=s.length;t<e;++t){var a=s[t],h=new cn(n.slice(o,a),i);r.push(h),o=a}return r}getOrientedFlatCoordinates(){var t;return this.orientedRevision_!=this.getRevision()&&(!function(i,n,s,r){for(let t=0,e=s.length;t<e;++t){var o=s[t],a=vn(i,n,o,r);if(0===t){if(!a)return}else if(a)return;n=o}return 1}(t=this.flatCoordinates,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=xn(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()),this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){var e=[],i=[];return e.length=function(i,n,s,r,o,a,h,l){for(let t=0,e=s.length;t<e;++t){var d=s[t];h=function(s,r,o,a,h,l,d){if(r!=o){let t,e,i=an(s[r],h),n=an(s[r+1],h);r+=a,l[d++]=i,l[d++]=n;do{if(t=an(s[r],h),e=an(s[r+1],h),(r+=a)==o)return l[d++]=t,l[d++]=e,d}while(t==i&&e==n);for(;r<o;){const o=an(s[r],h),m=an(s[r+1],h);var u,c,g,_;r+=a,o==t&&m==e||(u=t-i,c=e-n,g=o-i,_=m-n,e=(t=(u*_==c*g&&(u<0&&g<u||u==g||0<u&&u<g)&&(c<0&&_<c||c==_||0<c&&c<_)||(l[d++]=t,l[d++]=e,i=t,n=e),o),m))}l[d++]=t,l[d++]=e}return d}(i,n,d,r,o,a,h),l.push(h),n=d}return h}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new yn(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){var i=this.getOrientedFlatCoordinates(),n=this.ends_,s=this.stride,r=t;if(!fn(i,0,n[0],s,r))return!1;if(1!==n.length)for(let t=1,e=n.length;t<e;++t)if(function(e,i,n,s,t){return!Lt(t,function(t){return!_n(e,i,n,s,t[0],t[1])})}(i,n[t-1],n[t],s,r)&&!pn(i,n[t-1],n[t],s,r))return!1;return!0}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);e=function(i,n,s,r,o){o=o||[];let a=0;for(let t=0,e=s.length;t<e;++t){var h=on(i,n,s[t],r);n=o[a++]=h}return o.length=a,o}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===e.length?0:e[e.length-1],this.changed()}}const Cn=yn;function Sn(t){var e=t[0],i=t[1],n=t[2],t=t[3],t=[e,i,e,t,n,t,n,i,e,i];return new yn(t,"XY",[t.length])}function wn(t,e){setTimeout(function(){t(e)},0)}function En(t,e,i,n,s){var r=Math.cos(-s),s=Math.sin(-s),o=t[0]*r-t[1]*s,t=t[1]*r+t[0]*s;return[(o+=(e[0]/2-i[0])*n)*r-(t+=(i[1]-e[1]/2)*n)*(s=-s),t*r+o*s]}const y=class extends e{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Pi(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Ri(),t.center&&(t.center=v(t.center,this.projection_)),t.extent&&(t.extent=Wi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(e){var t=Object.assign({},e);for(const e in g)delete t[e];this.setProperties(t,!0);var i=function(t){let e,i,n,s=void 0!==t.minZoom?t.minZoom:0,r=void 0!==t.maxZoom?t.maxZoom:28;const o=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,h=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,l=void 0!==t.showFullExtent&&t.showFullExtent,d=Pi(t.projection,"EPSG:3857"),u=d.getExtent();let c=t.constrainOnlyCenter,g=t.extent;if(a||g||!d.isGlobal()||(c=!1,g=u),void 0!==t.resolutions){const o=t.resolutions;i=o[s],n=void 0!==o[r]?o[r]:o[o.length-1],e=t.constrainResolution?(y=o,C=h,S=!c&&g,w=l,C=void 0===C||C,function(t,e,i,n){var s,r;if(void 0!==t)return r=y[0],s=y[y.length-1],i=S?Yi(r,S,i,w):r,n?C?Bi(t,i,s):E(t,s,i):(r=Math.min(i,t),n=Math.floor(M(y,r,e)),y[n]>i&&n<y.length-1?y[n+1]:y[n])}):ji(i,n,h,!c&&g,l)}else{const M=(u?Math.max(Y(u),N(u)):360*ai.degrees/d.getMetersPerUnit())/256/Math.pow(2,0),a=M/Math.pow(2,28);void 0!==(i=t.maxResolution)?s=0:i=M/Math.pow(o,s),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(o,r):M/Math.pow(o,r):a),r=s+Math.floor(Math.log(i/n)/Math.log(o)),n=i/Math.pow(o,r-s),e=t.constrainResolution?(_=o,m=i,p=n,f=h,v=!c&&g,x=l,f=void 0===f||f,p=void 0!==p?p:0,function(t,e,i,n){if(void 0!==t)return i=v?Yi(m,v,i,x):m,n?f?Bi(t,i,p):E(t,p,i):(n=Math.ceil(Math.log(m/i)/Math.log(_)-1e-9),e=-e*(.5-1e-9)+.5,t=Math.min(i,t),t=Math.floor(Math.log(m/t)/Math.log(_)+e),e=Math.max(n,t),E(m/Math.pow(_,e),p,i))}):ji(i,n,h,!c&&g,l)}var _,m,p,f,v,x,y,C,S,w;return{constraint:e,maxResolution:i,minResolution:n,minZoom:s,zoomFactor:o}}(e),n=(this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom,function(t){if(void 0!==t.extent){const e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Xi(t.extent,t.constrainOnlyCenter,e)}const e=Pi(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Xi(t,!1,!1)}return Ni}(e)),i=i.constraint,s=function(){if(void 0===e.enableRotation||e.enableRotation){var t=e.constrainRotation;if(void 0===t||!0===t)return i=i||jt(5),function(t,e){return e?t:void 0!==t?Math.abs(t)<=i?0:t:void 0};else if(!1!==t&&"number"==typeof t){const n=2*Math.PI/t;return function(t,e){return e?t:void 0!==t?Math.floor(t/n+.5)*n:void 0};return}else return Ki}return Zi;var i}();this.constraints_={center:n,resolution:i,rotation:s},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(t){var e,i,n=this.padding_,s=(this.padding_=t,this.getCenter());s&&(t=t||[0,0,0,0],n=n||[0,0,0,0],e=(i=this.getResolution())/2*(t[3]-n[3]+n[1]-t[1]),i=i/2*(t[0]-n[0]+n[2]-t[2]),this.setCenterInternal([s[0]+e,s[1]-i]))}getUpdatedOptions_(t){var e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);var i=new Array(arguments.length);for(let e=0;e<i.length;++e){let t=arguments[e];t.center&&((t=Object.assign({},t)).center=v(t.center,this.getProjection())),t.anchor&&((t=Object.assign({},t)).anchor=v(t.anchor,this.getProjection())),i[e]=t}this.animateInternal.apply(this,i)}animateInternal(s){let r,o=arguments.length,a=(1<o&&"function"==typeof arguments[o-1]&&(r=arguments[o-1],--o),0);for(;a<o&&!this.isDef();++a){const s=arguments[a];s.center&&this.setCenterInternal(s.center),void 0!==s.zoom?this.setZoom(s.zoom):s.resolution&&this.setResolution(s.resolution),void 0!==s.rotation&&this.setRotation(s.rotation)}if(a===o)r&&wn(r,!0);else{let t=Date.now(),e=this.targetCenter_.slice(),i=this.targetResolution_,n=this.targetRotation_;for(var h,l=[];a<o;++a){const s=arguments[a],o={start:t,complete:!1,anchor:s.anchor,duration:void 0!==s.duration?s.duration:1e3,easing:s.easing||qi,callback:r};if(s.center&&(o.sourceCenter=e,o.targetCenter=s.center.slice(),e=o.targetCenter),void 0!==s.zoom?(o.sourceResolution=i,o.targetResolution=this.getResolutionForZoom(s.zoom),i=o.targetResolution):s.resolution&&(o.sourceResolution=i,o.targetResolution=s.resolution,i=o.targetResolution),void 0!==s.rotation){o.sourceRotation=n;const r=Zt(s.rotation-n+Math.PI,2*Math.PI)-Math.PI;o.targetRotation=n+r,n=o.targetRotation}(h=o).sourceCenter&&h.targetCenter&&!fe(h.sourceCenter,h.targetCenter)||h.sourceResolution!==h.targetResolution||h.sourceRotation!==h.targetRotation?t+=o.duration:o.complete=!0,l.push(o)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}}getAnimating(){return 0<this.hints_[0]}getInteracting(){return 0<this.hints_[1]}cancelAnimations(){let i;this.setHint(0,-this.hints_[0]);for(let t=0,e=this.animations_.length;t<e;++t){var n=this.animations_[t];if(n[0].callback&&wn(n[0].callback,!1),!i)for(let t=0,e=n.length;t<e;++t){var s=n[t];if(!s.complete){i=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=i,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){const l=Date.now();let n=!1;for(let t=this.animations_.length-1;0<=t;--t){var s=this.animations_[t];let i=!0;for(let t=0,e=s.length;t<e;++t){var r=s[t];if(!r.complete){var o=l-r.start;let t=0<r.duration?o/r.duration:1;1<=t?(r.complete=!0,t=1):i=!1;o=r.easing(t);if(r.sourceCenter){const l=r.sourceCenter[0],t=r.sourceCenter[1],d=r.targetCenter[0],u=r.targetCenter[1];this.nextCenter_=r.targetCenter;var a=l+o*(d-l),h=t+o*(u-t);this.targetCenter_=[a,h]}if(r.sourceResolution&&r.targetResolution){const l=1===o?r.targetResolution:r.sourceResolution+o*(r.targetResolution-r.sourceResolution);if(r.anchor){const t=this.getViewportSize_(this.getRotation()),c=this.constraints_.resolution(l,0,t,!0);this.targetCenter_=this.calculateCenterZoom(c,r.anchor)}this.nextResolution_=r.targetResolution,this.targetResolution_=l,this.applyTargetState_(!0)}if(void 0!==r.sourceRotation&&void 0!==r.targetRotation){const l=1===o?Zt(r.targetRotation+Math.PI,2*Math.PI)-Math.PI:r.sourceRotation+o*(r.targetRotation-r.sourceRotation);if(r.anchor){const t=this.constraints_.rotation(l,!0);this.targetCenter_=this.calculateCenterRotate(t,r.anchor)}this.nextRotation_=r.targetRotation,this.targetRotation_=l}if(this.applyTargetState_(!0),n=!0,!r.complete)break}}if(i){this.animations_[t]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const l=s[0].callback;l&&wn(l,!0)}}this.animations_=this.animations_.filter(Boolean),n&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}}calculateCenterRotate(t,e){let i;var n=this.getCenterInternal();return void 0!==n&&(ve(i=[n[0]-e[0],n[1]-e[1]],t-this.getRotation()),n=e,(t=i)[0]+=+n[0],t[1]+=+n[1]),i}calculateCenterZoom(t,e){let i;var n=this.getCenterInternal(),s=this.getResolution();return i=void 0!==n&&void 0!==s?[e[0]-t*(e[0]-n[0])/s,e[1]-t*(e[1]-n[1])/s]:i}getViewportSize_(t){var e,i,n=this.viewportSize_;return t?(e=n[0],i=n[1],[Math.abs(e*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(e*Math.sin(t))+Math.abs(i*Math.cos(t))]):n}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){var t=this.getCenterInternal();return t&&Gi(t,this.getProjection())}getCenterInternal(){return this.get(g.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return zi(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();var e=this.getCenterInternal(),i=(d(e,1),this.getResolution()),n=(d(void 0!==i,2),this.getRotation());return d(void 0!==n,3),Ot(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(g.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Wi(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();var i=Y(t)/e[0],t=N(t)/e[1];return Math.max(i,t)}getResolutionForValueFunction(e){e=e||2;const i=this.getConstrainedResolution(this.maxResolution_),t=this.minResolution_,n=Math.log(i/t)/Math.log(e);return function(t){return i/Math.pow(e,t*n)}}getRotation(){return this.get(g.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/e;return function(t){return Math.log(i/t)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);t=this.padding_;return e=t?[e[0]-t[1]-t[3],e[1]-t[0]-t[2]]:e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();var s=this.padding_;if(s){const t=this.getViewportSizeMinusPadding_();n=En(n,this.getViewportSize_(),[t[0]/2+s[3],t[1]/2+s[0]],e,i)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;var e=this.getResolution();return t=void 0!==e?this.getZoomForResolution(e):t}getZoomForResolution(t){let e,i,n=this.minZoom_||0;var s;return i=this.resolutions_?(s=M(this.resolutions_,t,1),n=s,e=this.resolutions_[s],s==this.resolutions_.length-1?2:e/this.resolutions_[s+1]):(e=this.maxResolution_,this.zoomFactor_),n+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){var e,i;return this.resolutions_?this.resolutions_.length<=1?0:(e=E(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1],this.resolutions_[e]/Math.pow(i,E(t-e,0,1))):this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(d(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))d(!Nt(t),25),i=Sn(Wi(t,this.getProjection()));else if("Circle"===t.getType()){const e=Wi(t.getExtent(),this.getProjection());(i=Sn(e)).rotate(this.getRotation(),Dt(e))}else{const e=null;i=t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const i=this.getRotation(),n=Math.cos(i),s=Math.sin(-i),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,h=1/0,l=-1/0,d=-1/0;for(let t=0,e=r.length;t<e;t+=o){const i=r[t]*n-r[t+1]*s,o=r[t]*s+r[t+1]*n;a=Math.min(a,i),h=Math.min(h,o),l=Math.max(l,i),d=Math.max(d,o)}return[a,h,l,d]}fitInternal(t,e){let i=(e=e||{}).size;i=i||this.getViewportSizeMinusPadding_();var n=void 0!==e.padding?e.padding:[0,0,0,0],s=void 0!==e.nearest&&e.nearest,r=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0,t=this.rotatedExtentForGeometry(t),o=this.getResolutionForExtentInternal(t,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]),o=isNaN(o)?r:Math.max(o,r),r=(o=this.getConstrainedResolution(o,s?0:1),this.getRotation()),s=Math.sin(r),r=Math.cos(r),t=Dt(t),n=(t[0]+=(n[1]-n[3])/2*o,t[1]+=(n[0]-n[2])/2*o,t[0]*r-t[1]*s),r=t[1]*r+t[0]*s,t=this.getConstrainedCenter([n,r],o),s=e.callback||k;void 0!==e.duration?this.animateInternal({resolution:o,center:t,duration:e.duration,easing:e.easing},s):(this.targetResolution_=o,this.targetCenter_=t,this.applyTargetState_(!1,!0),wn(s,!0))}centerOn(t,e,i){this.centerOnInternal(v(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(En(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let s;var r=this.padding_;return r&&t&&(n=En(t,n,[(n=this.getViewportSizeMinusPadding_(-i))[0]/2+r[3],n[1]/2+r[0]],e,i),s=[t[0]-n[0],t[1]-n[1]]),s}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){var e=Gi(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&v(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){var i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(n,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e=e&&v(e,this.getProjection()),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){var i=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&v(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){var e=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,e),n=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,0,n,e),e=this.constraints_.center(this.targetCenter_,s,n,e,this.calculateCenterShift(this.targetCenter_,s,i,n));this.get(g.ROTATION)!==i&&this.set(g.ROTATION,i),this.get(g.RESOLUTION)!==s&&(this.set(g.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),e&&this.get(g.CENTER)&&fe(this.get(g.CENTER),e)||this.set(g.CENTER,e),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;var e=e||0,n=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(n),e=this.constraints_.resolution(this.targetResolution_,e,s),s=this.constraints_.center(this.targetCenter_,e,s,!1,this.calculateCenterShift(this.targetCenter_,e,n,s));0!==t||this.cancelAnchor_?(i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===e&&this.getRotation()===n&&this.getCenterInternal()&&fe(this.getCenterInternal(),s)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:n,center:s,resolution:e,duration:t,easing:Ui,anchor:i}))):(this.targetResolution_=e,this.targetRotation_=n,this.targetCenter_=s,this.applyTargetState_())}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&v(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){var i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){t=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(t,e))}getConstrainedResolution(t,e){e=e||0;var i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}},Tn=class extends e{constructor(t){super();var e=t.element;!e||t.target||e.style.pointerEvents||(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Fe(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Fe(this.element);for(let t=0,e=this.listenerKeys.length;t<e;++t)a(this.listenerKeys[t]);this.listenerKeys.length=0,(this.map_=t)&&((this.target_||t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==k&&this.listenerKeys.push(r(t,$e,this.render,this)),t.render())}render(t){}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}},Rn=class extends Tn{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);var e=void 0!==t.className?t.className:"ol-attribution",i=void 0!==t.tipLabel?t.tipLabel:"Attributions",n=void 0!==t.expandClassName?t.expandClassName:e+"-expand",s=void 0!==t.collapseLabel?t.collapseLabel:"›",r=void 0!==t.collapseClassName?t.collapseClassName:e+"-collapse",r=("string"==typeof s?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=r):this.collapseLabel_=s,void 0!==t.label?t.label:"i"),s=("string"==typeof r?(this.label_=document.createElement("span"),this.label_.textContent=r,this.label_.className=n):this.label_=r,this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_),t=(this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(s),this.toggleButton_.addEventListener(j,this.handleClick_.bind(this),!1),e+" ol-unselectable "+Te+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible")),n=this.element;n.className=t,n.appendChild(this.toggleButton_),n.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(i){var n={},s=[];let r=!0;var o=i.layerStatesArray;for(let t=0,e=o.length;t<e;++t){var a=o[t];if(me(a,i.viewState)){a=a.layer.getSource();if(a){var h=a.getAttributions();if(h){var l=h(i);if(l)if(r=r&&!1!==a.getAttributionsCollapsible(),Array.isArray(l))for(let t=0,e=l.length;t<e;++t)l[t]in n||(s.push(l[t]),n[l[t]]=!0);else l in n||(s.push(l),n[l]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(r),s}updateElement_(t){if(t){const i=this.collectSourceAttributions_(t),n=0<i.length;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!gt(i,this.renderedAttributions_)){for(var e=this.ulElement_;e.lastChild;)e.removeChild(e.lastChild);for(let t=0,e=i.length;t<e;++t){const n=document.createElement("li");n.innerHTML=i[t],this.ulElement_.appendChild(n)}this.renderedAttributions_=i}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle("ol-collapsed"),this.collapsed_?Me(this.collapseLabel_,this.label_):Me(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_)&&this.handleToggle_()}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},In=class extends Tn{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});var e=void 0!==t.className?t.className:"ol-rotate",i=void 0!==t.label?t.label:"⇧",n=void 0!==t.compassClassName?t.compassClassName:"ol-compass",i=(this.label_=null,"string"==typeof i?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n)),t.tipLabel||"Reset rotation"),n=document.createElement("button"),i=(n.className=e+"-reset",n.setAttribute("type","button"),n.title=i,n.appendChild(this.label_),n.addEventListener(j,this.handleClick_.bind(this),!1),e+" ol-unselectable "+Te),e=this.element;e.className=i,e.appendChild(n),this.callResetNorth_=t.resetNorth||void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ee)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){var t,e=this.getMap().getView();e&&void 0!==(t=e.getRotation())&&(0<this.duration_&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Ui}):e.setRotation(0))}render(t){t=t.frameState;if(t){var e=t.viewState.rotation;if(e!=this.rotation_){const t="rotate("+e+"rad)";if(this.autoHide_){const t=this.element.classList.contains(Ee);t||0!==e?t&&0!==e&&this.element.classList.remove(Ee):this.element.classList.add(Ee)}this.label_.style.transform=t}this.rotation_=e}}},bn=class extends Tn{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});var e=void 0!==t.className?t.className:"ol-zoom",i=void 0!==t.delta?t.delta:1,n=void 0!==t.zoomInClassName?t.zoomInClassName:e+"-in",s=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+"-out",r=void 0!==t.zoomInLabel?t.zoomInLabel:"+",o=void 0!==t.zoomOutLabel?t.zoomOutLabel:"–",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",h=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",l=document.createElement("button"),n=(l.className=n,l.setAttribute("type","button"),l.title=a,l.appendChild("string"==typeof r?document.createTextNode(r):r),l.addEventListener(j,this.handleClick_.bind(this,i),!1),document.createElement("button")),a=(n.className=s,n.setAttribute("type","button"),n.title=h,n.appendChild("string"==typeof o?document.createTextNode(o):o),n.addEventListener(j,this.handleClick_.bind(this,-i),!1),e+" ol-unselectable "+Te),r=this.element;r.className=a,r.appendChild(l),r.appendChild(n),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){var e,i=this.getMap().getView();i&&void 0!==(e=i.getZoom())&&(e=i.getConstrainedZoom(e+t),0<this.duration_?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:e,duration:this.duration_,easing:Ui})):i.setZoom(e))}};function Mn(t,e,i,n){var s=t.getZoom();void 0!==s&&(s=t.getConstrainedZoom(s+e),e=t.getResolutionForZoom(s),t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:e,anchor:i,duration:void 0!==n?n:250,easing:Ui}))}const Fn=class extends e{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get("active")}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set("active",t)}setMap(t){this.map_=t}},Ln=class extends Fn{constructor(t){super(),this.delta_=(t=t||{}).delta||1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;var i,n,s;return t.type==u.DBLCLICK&&(i=t.originalEvent,n=t.map,t=t.coordinate,s=i.shiftKey?-this.delta_:this.delta_,Mn(n.getView(),s,t,this.duration_),i.preventDefault(),e=!0),!e}};function Pn(e){var i=e.length;let n=0,s=0;for(let t=0;t<i;t++)n+=e[t].clientX,s+=e[t].clientY;return[n/i,s/i]}p=class extends Fn{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;var i;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==u.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==u.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&0<this.targetPointers.length}}else t.type==u.POINTERDOWN?(i=this.handleDownEvent(t),this.handlingDownUpSequence=i,e=this.stopDown(i)):t.type==u.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function kn(){const s=arguments;return function(i){let n=!0;for(let t=0,e=s.length;t<e&&(n=n&&s[t](i));++t);return n}}function An(t){return(t=t.originalEvent).altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey}function Dn(t){return!t.map.getTargetElement().hasAttribute("tabindex")||(e=(t=t).map.getTargetElement(),t=t.map.getOwnerDocument().activeElement,e.contains(t));var e}function On(t){return 0==(t=t.originalEvent).button&&!(at&&ht&&t.ctrlKey)}function Gn(t){return!(t=t.originalEvent).altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey}function zn(t){return!(t=t.originalEvent).altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey}function Wn(t){var e=(t=t.originalEvent).target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&!t.target.isContentEditable}function Xn(t){return d(void 0!==(t=t.originalEvent),56),"mouse"==t.pointerType}function Nn(t){return d(void 0!==(t=t.originalEvent),56),t.isPrimary&&0===t.button}const Yn=L,Bn=class extends p{constructor(t){super({stopDown:P}),this.kinetic_=(t=t||{}).kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;var e=t.condition||kn(Gn,Nn);this.condition_=t.onFocusOnly?kn(Dn,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=Pn(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const e=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],r=t.map.getView();n=e,s=r.getResolution(),n[0]*=s,n[1]*=s,ve(e,r.getRotation()),r.adjustCenterInternal(e)}}else this.kinetic_&&this.kinetic_.begin();var n,s;this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){var e=t.map,i=e.getView();if(0!==this.targetPointers.length)return this.kinetic_&&this.kinetic_.begin(),!(this.lastCentroid=null);if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),s=i.getCenterInternal(),r=e.getPixelFromCoordinateInternal(s),o=e.getCoordinateFromPixelInternal([r[0]-t*Math.cos(n),r[1]-t*Math.sin(n)]);i.animateInternal({center:i.getConstrainedCenter(o),duration:500,easing:Ui})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}handleDownEvent(t){return!!(0<this.targetPointers.length&&this.condition_(t))&&(t=t.map.getView(),this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=1<this.targetPointers.length,!0)}},jn=class extends p{constructor(t){t=t||{},super({stopDown:P}),this.condition_=t.condition||An,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(Xn(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==Zi){e=e.getSize(),t=t.pixel,e=Math.atan2(e[1]/2-t[1],t[0]-e[0]/2);if(void 0!==this.lastAngle_){const t=e-this.lastAngle_;i.adjustRotationInternal(-t)}this.lastAngle_=e}}}handleUpEvent(t){return!Xn(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!(!Xn(t)||!On(t)||!this.condition_(t)||(t.map.getView().beginInteraction(),this.lastAngle_=void 0))}},Zn=class extends b{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){var t=this.startPixel_,e=this.endPixel_,i=this.element_.style;i.left=Math.min(t[0],e[0])+"px",i.top=Math.min(t[1],e[1])+"px",i.width=Math.abs(e[0]-t[0])+"px",i.height=Math.abs(e[1]-t[1])+"px"}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){var t=this.startPixel_,e=this.endPixel_,e=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);e[4]=e[0].slice(),this.geometry_?this.geometry_.setCoordinates([e]):this.geometry_=new Cn([e])}getGeometry(){return this.geometry_}};class Kn extends t{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}const Vn=class extends p{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Zn(t.className||"ol-dragbox"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition||On,this.boxEndCondition_=t.boxEndCondition||this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){var n=i[0]-e[0],i=i[1]-e[1];return n*n+i*i>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Kn("boxdrag",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Kn(e?"boxend":"boxcancel",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Kn("boxstart",t.coordinate,t)),!0)}onBoxEnd(t){}},Un=class extends Vn{constructor(t){super({condition:(t=t||{}).condition?t.condition:zn,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){var e=this.getMap().getView();let i=this.getGeometry();if(this.out_){const t=e.rotatedExtentForGeometry(i),n=e.getResolutionForExtentInternal(t),s=e.getResolution()/n;(i=i.clone()).scale(s*s)}e.fitInternal(i,{duration:this.duration_,easing:Ui})}},qn=class extends Fn{constructor(t){super(),t=t||{},this.defaultCondition_=function(t){return Gn(t)&&Wn(t)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(i){let n=!1;if(i.type==Z){var s=i.originalEvent,r=s.keyCode;if(this.condition_(i)&&(40==r||37==r||39==r||38==r)){var i=i.map.getView(),o=i.getResolution()*this.pixelDelta_;let t=0,e=0;40==r?e=-o:37==r?t=-o:39==r?t=o:e=o;r=[t,e];ve(r,i.getRotation()),o=i,i=r,r=this.duration_,(a=o.getCenterInternal())&&(a=[a[0]+i[0],a[1]+i[1]],o.animateInternal({duration:void 0!==r?r:250,easing:Hi,center:o.getConstrainedCenter(a)})),s.preventDefault(),n=!0}}var a;return!n}},Hn=class extends Fn{constructor(t){super(),this.condition_=(t=t||{}).condition||Wn,this.delta_=t.delta||1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;var i,n;return t.type!=Z&&t.type!=K||(n=(i=t.originalEvent).charCode,!this.condition_(t))||n!="+".charCodeAt(0)&&n!="-".charCodeAt(0)||(t=t.map,n=n=="+".charCodeAt(0)?this.delta_:-this.delta_,Mn(t.getView(),n,void 0,this.duration_),i.preventDefault(),e=!0),!e}},Jn=class extends Fn{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;var e=t.condition||Yn;this.condition_=t.onFocusOnly?kn(Dn,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;var t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?0<this.lastDelta_?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t))return!0;if(t.type!==U)return!0;var e,i=t.map,n=t.originalEvent;let s;return n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==U&&(s=n.deltaY,ot&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=lt),n.deltaMode===WheelEvent.DOM_DELTA_LINE)&&(s*=40),0!==s&&(this.lastDelta_=s,t=Date.now(),void 0===this.startTime_&&(this.startTime_=t),(!this.mode_||t-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel"),n=i.getView(),"trackpad"!==this.mode_||n.getConstrainResolution()||this.constrainResolution_?(this.totalDelta_+=s,e=Math.max(this.timeout_-(t-this.startTime_),0),clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),e)):(this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(n.getAnimating()&&n.cancelAnimations(),n.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),n.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=t)),!1}handleWheelZoom_(t){t=t.getView();t.getAnimating()&&t.cancelAnimations();let e=-E(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(e=e?0<e?1:-1:0),Mn(t,e,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){(this.useAnchor_=t)||(this.lastAnchor_=null)}},Qn=class extends p{constructor(t){var e=t=t||{};e.stopDown||(e.stopDown=P),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;var i=this.targetPointers[0],n=this.targetPointers[1],n=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){const t=n-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=n;var s,i=t.map,n=i.getView();n.getConstraints().rotation!==Zi&&(t=i.getViewport().getBoundingClientRect(),(s=Pn(this.targetPointers))[0]-=t.left,s[1]-=t.top,this.anchor_=i.getCoordinateFromPixelInternal(s),this.rotating_)&&(i.render(),n.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))}handleDownEvent(t){return 2<=this.targetPointers.length&&(t=t.map,this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0)}},$n=class extends p{constructor(t){var e=t=t||{};e.stopDown||(e.stopDown=P),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;var i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,i=i.clientY-n.clientY,n=Math.sqrt(s*s+i*i),s=(void 0!==this.lastDistance_&&(e=this.lastDistance_/n),this.lastDistance_=n,t.map),i=s.getView(),n=(1!=e&&(this.lastScaleDelta_=e),s.getViewport().getBoundingClientRect()),t=Pn(this.targetPointers);t[0]-=n.left,t[1]-=n.top,this.anchor_=s.getCoordinateFromPixelInternal(t),s.render(),i.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){var e;return!(this.targetPointers.length<2&&(t=t.map.getView(),e=1<this.lastScaleDelta_?1:-1,t.endInteraction(this.duration_,e),1))}handleDownEvent(t){return 2<=this.targetPointers.length&&(t=t.map,this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0)}};function ts(t){t=t||{};var e=new l,i=new class{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[2+e]<t)return!1;let i=e-3;for(;0<i&&this.points_[i+2]>t;)i-=3;var n,s=this.points_[2+e]-this.points_[i+2];return!(s<1e3/60)&&(n=this.points_[e]-this.points_[i],e=this.points_[1+e]-this.points_[i+1],this.angle_=Math.atan2(e,n),this.initialVelocity_=Math.sqrt(n*n+e*e)/s,this.initialVelocity_>this.minVelocity_)}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return void 0!==t.altShiftDragRotate&&!t.altShiftDragRotate||e.push(new jn),void 0!==t.doubleClickZoom&&!t.doubleClickZoom||e.push(new Ln({delta:t.zoomDelta,duration:t.zoomDuration})),void 0!==t.dragPan&&!t.dragPan||e.push(new Bn({onFocusOnly:t.onFocusOnly,kinetic:i})),void 0!==t.pinchRotate&&!t.pinchRotate||e.push(new Qn),void 0!==t.pinchZoom&&!t.pinchZoom||e.push(new $n({duration:t.zoomDuration})),void 0!==t.keyboard&&!t.keyboard||(e.push(new qn),e.push(new Hn({delta:t.zoomDelta,duration:t.zoomDuration}))),void 0!==t.mouseWheelZoom&&!t.mouseWheelZoom||e.push(new Jn({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),void 0!==t.shiftDragZoom&&!t.shiftDragZoom||e.push(new Un({duration:t.zoomDuration})),e}function es(t){return 0<t[0]&&0<t[1]}function C(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}function is(t){t instanceof pe?t.setMapInternal(null):t instanceof qe&&t.getLayers().forEach(is)}const ns=class extends e{constructor(t){super(),this.on,this.once,this.un;var e,i,n=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var i={},n=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new qe({layers:t.layers});let s,r,o;return i.layergroup=n,i.target=t.target,i.view=t.view instanceof y?t.view:new y,void 0!==t.controls&&(s=Array.isArray(t.controls)?new l(t.controls.slice()):(d("function"==typeof t.controls.getArray,47),t.controls)),void 0!==t.interactions&&(r=Array.isArray(t.interactions)?new l(t.interactions.slice()):(d("function"==typeof t.interactions.getArray,48),t.interactions)),o=void 0!==t.overlays?Array.isArray(t.overlays)?new l(t.overlays.slice()):(d("function"==typeof t.overlays.getArray,49),t.overlays):new l,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:i}}(t=t||{});this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:lt,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=n.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=n.controls||(e={},i=new l,void 0!==e.zoom&&!e.zoom||i.push(new bn(e.zoomOptions)),void 0!==e.rotate&&!e.rotate||i.push(new In(e.rotateOptions)),void 0!==e.attribution&&!e.attribution||i.push(new Rn(e.attributionOptions)),i),this.interactions=n.interactions||ts({onFocusOnly:!0}),this.overlays_=n.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new oi(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ii,this.handleLayerGroupChanged_),this.addChangeListener(ri,this.handleViewChanged_),this.addChangeListener(ni,this.handleSizeChanged_),this.addChangeListener(si,this.handleTargetChanged_),this.setProperties(n.values);const s=this;!t.view||t.view instanceof y||t.view.then(function(t){s.setView(new y(t))}),this.controls.addEventListener(nt,function(t){t.element.setMap(this)}.bind(this)),this.controls.addEventListener(st,function(t){t.element.setMap(null)}.bind(this)),this.interactions.addEventListener(nt,function(t){t.element.setMap(this)}.bind(this)),this.interactions.addEventListener(st,function(t){t.element.setMap(null)}.bind(this)),this.overlays_.addEventListener(nt,function(t){this.addOverlayInternal_(t.element)}.bind(this)),this.overlays_.addEventListener(st,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)}.bind(this)),this.controls.forEach(function(t){t.setMap(this)}.bind(this)),this.interactions.forEach(function(t){t.setMap(this)}.bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){!function i(t,n){if(t instanceof pe)t.setMapInternal(n);else if(t instanceof qe){var s=t.getLayers().getArray();for(let t=0,e=s.length;t<e;++t)i(s[t],n)}}(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){var n,s;if(this.frameState_&&this.renderer_)return t=this.getCoordinateFromPixelInternal(t),n=void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,s=void 0!==i.layerFilter?i.layerFilter:L,i=!1!==i.checkWrapped,this.renderer_.forEachFeatureAtCoordinate(t,this.frameState_,n,i,e,null,s,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(t){i.push(t)},e),i}getAllLayers(){const i=[];return function e(t){t.forEach(function(t){t instanceof qe?e(t.getLayers()):i.push(t)})}(this.getLayers()),i}hasFeatureAtPixel(t,e){var i,n;return!(!this.frameState_||!this.renderer_)&&(t=this.getCoordinateFromPixelInternal(t),i=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:L,n=void 0!==e.hitTolerance?e.hitTolerance:0,e=!1!==e.checkWrapped,this.renderer_.hasFeatureAtCoordinate(t,this.frameState_,n,e,i,null))}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){var e=this.viewport_.getBoundingClientRect(),t="changedTouches"in t?t.changedTouches[0]:t;return[t.clientX-e.left,t.clientY-e.top]}getTarget(){return this.get(si)}getTargetElement(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null}getCoordinateFromPixel(t){return Gi(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){var e=this.frameState_;return e?W(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){t=this.overlayIdIndex_[t.toString()];return void 0!==t?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ii)}setLayers(t){var e=this.getLayerGroup();t instanceof l?e.setLayers(t):((e=e.getLayers()).clear(),e.extend(t))}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){var i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){var n=i[t];if(n.visible){var s=n.layer.getRenderer();if(s&&!s.ready)return!0;s=n.layer.getSource();if(s&&s.loading)return!0}}return!1}getPixelFromCoordinate(t){t=v(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(t){var e=this.frameState_;return e?W(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ni)}getView(){return this.get(ri)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){var t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return s=this.frameState_,t=t,e=e,i=i,n=n,s&&e in s.wantedTiles&&s.wantedTiles[e][t.getKey()]?(e=s.viewState.center,t=i[0]-e[0],s=i[1]-e[1],65536*Math.log(n)+Math.sqrt(t*t+s*s)/n):1/0;var s}handleBrowserEvent(t,e){e=e||t.type;e=new n(e,this,t);this.handleMapBrowserEvent(e)}handleMapBrowserEvent(e){if(this.frameState_){const n=e.originalEvent,t=n.type;if(t===Je||t===U||t===Z){const e=this.getOwnerDocument(),t=this.viewport_.getRootNode?this.viewport_.getRootNode():e,s=n.target;if(this.overlayContainerStopEvent_.contains(s)||!(t===e?e.documentElement:t).contains(s))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e)){const n=this.getInteractions().getArray().slice();for(let t=n.length-1;0<=t;t--){var i=n[t];if(i.getMap()===this&&i.getActive()&&this.getTargetElement()&&(!i.handleEvent(e)||e.propagationStopped))break}}}}handlePostRender(){const i=this.frameState_,n=this.tileQueue_;if(!n.isEmpty()){let t=this.maxTilesLoading_,e=t;if(i){const n=i.viewHints;if(n[0]||n[1]){const n=8<Date.now()-i.time;t=n?0:8,e=n?0:2}}n.getTilesLoading()<t&&(n.reprioritize(),n.loadMoreTiles(t,e))}i&&this.renderer_&&!i.animate&&(!0===this.renderComplete_?(this.hasListener(_e)&&this.renderer_.dispatchRenderEvent(_e,i),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new He(ei,this,i)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new He(ti,this,i))));var s=this.postRenderFunctions_;for(let t=0,e=s.length;t<e;++t)s[t](this,i);s.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)a(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(B,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(U,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Fe(this.viewport_)}const t=this.getTargetElement();if(t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Ve(this)),this.mapBrowserEventHandler_=new Qe(this,this.moveTolerance_);for(const t in u)this.mapBrowserEventHandler_.addEventListener(u[t],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(B,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(U,this.boundHandleBrowserEvent_,!!ct&&{passive:!1});var e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_||t;this.targetChangeHandlerKeys_=[r(i,Z,this.handleBrowserEvent,this),r(i,K,this.handleBrowserEvent,this),r(e,"resize",this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(a(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(a(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=r(t,I,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=r(t,o,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(a),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.handleLayerAdd_(new s("addlayer",t)),this.layerGroupPropertyListenerKeys_=[r(t,I,this.render,this),r(t,o,this.render,this),r(t,"addlayer",this.handleLayerAdd_,this),r(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){var i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){var n=i[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){is(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(void 0!==e&&es(e)&&i&&i.isDef()){const n=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),r=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Ot(r.center,r.resolution,r.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:r,viewHints:n,wantedTiles:{},mapId:z(this),renderTargets:{}},r.nextCenter&&r.nextResolution){const t=isNaN(r.nextRotation)?r.rotation:r.nextRotation;s.nextExtent=Ot(r.nextCenter,r.nextResolution,t,e)}}this.frameState_=s,this.renderer_.renderFrame(s),!s||(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),!n||this.previousExtent_&&(Nt(this.previousExtent_)||bt(s.extent,this.previousExtent_))||(this.dispatchEvent(new He("movestart",this,n)),this.previousExtent_=It(this.previousExtent_)),!this.previousExtent_)||s.viewHints[0]||s.viewHints[1]||bt(s.extent,this.previousExtent_)||(this.dispatchEvent(new He("moveend",this,s)),Ct(s.extent,this.previousExtent_)),this.dispatchEvent(new He($e,this,s)),this.renderComplete_=this.hasListener(ti)||this.hasListener(ei)||this.hasListener(_e)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){var e=this.getLayerGroup();e&&this.handleLayerRemove_(new s("removelayer",e)),this.set(ii,t)}setSize(t){this.set(ni,t)}setTarget(t){this.set(si,t)}setView(t){if(!t||t instanceof y)this.set(ri,t);else{this.set(ri,new y);const e=this;t.then(function(t){e.setView(new y(t))})}}updateSize(){var t,e,i=this.getTargetElement();let n;i&&(e=getComputedStyle(i),t=i.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),e=i.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth),isNaN(t)||isNaN(e)||!es(n=[t,e])&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0.")),this.setSize(n),this.updateViewportSize_()}updateViewportSize_(){var e=this.getView();if(e){let t;var i=getComputedStyle(this.viewport_);i.width&&i.height&&(t=[parseInt(i.width,10),parseInt(i.height,10)]),e.setViewportSize(t)}}},ss=class extends O{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(o)}release(){3===this.state&&this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(this.interimTile){let t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t}while(t=t.interimTile)}return this}refreshInterimChain(){if(this.interimTile){let t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}}while(1!=t.getState()&&0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile)}}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){h()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;t=e-i+1e3/60;return t>=this.transition_?1:Vi(t/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}};function rs(t,e,i){let n=!0,s=!1,r=!1;const o=[q(t,"load",function(){r=!0,s||e()})];return t.src&&ut?(s=!0,t.decode().then(function(){n&&e()}).catch(function(t){n&&(r?e:i)()})):o.push(q(t,"error",i)),function(){n=!1,o.forEach(a)}}const os=class extends ss{constructor(t,e,i,n,s,r){super(t,e,r),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){var t;this.state=3,this.unlistenImage_(),this.image_=((t=w(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()}handleImageLoad_(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=2:this.state=4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_)&&(this.image_.crossOrigin=this.crossOrigin_),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=rs(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};let as;const hs=[];function ls(t,e,i,n,s){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(n,s),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,n)+1,Math.max(i,s)),t.restore()}function ds(t,e){return 2<Math.abs(t[4*e]-210)||2<Math.abs(t[4*e+3]-191.25)}function us(t,e,i,n){var s=Oi(i,e,t);let r=Fi(e,n,i);n=e.getMetersPerUnit(),void 0!==n&&(r*=n),i=t.getMetersPerUnit(),void 0!==i&&(r/=i),e=t.getExtent();if(!e||wt(e,s)){const e=Fi(t,r,s)/r;isFinite(e)&&0<e&&(r/=e)}return r}const cs=class extends ss{constructor(i,e,t,n,s,r,o,a,h,l,d,u){super(s,0,{interpolate:!!u}),this.renderEdges_=void 0!==d&&d,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;u=n.getTileCoordExtent(this.wrappedTileCoord_),d=this.targetTileGrid_.getExtent();let c=this.sourceTileGrid_.getExtent();a=d?zt(u,d):u;if(0===Pt(a))this.state=4;else{r=i.getExtent(),s=(r&&(c=c?zt(c,r):r),n.getResolution(this.wrappedTileCoord_[0])),d=function(e,i,t,n){var s=Dt(t);let r=us(e,i,s,n);return(!isFinite(r)||r<=0)&&Lt(t,function(t){return r=us(e,i,t,n),isFinite(r)&&0<r}),r}(i,t,a,s);if(!isFinite(d)||d<=0)this.state=4;else if(this.triangulation_=new class{constructor(t,e,i,n,s,r){this.sourceProj_=t,this.targetProj_=e;let o={};const a=Di(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return o[e]||(o[e]=a(t)),o[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Y(n)==Y(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Y(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Y(this.targetProj_.getExtent()):null;var t=Wt(i),e=Xt(i),s=At(i),n=kt(i),h=this.transformInv_(t),l=this.transformInv_(e),d=this.transformInv_(s),u=this.transformInv_(n),i=10+(r?Math.max(0,Math.ceil(Math.log2(Pt(i)/(r*r*256*256)))):0);if(this.addQuad_(t,e,s,n,h,l,d,u,i),this.wrapsXInSource_){let n=1/0;this.triangles_.forEach(function(t,e,i){n=Math.min(n,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){var e,i;Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-n>this.sourceWorldWidth_/2&&((e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]])[0][0]-n>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-n>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-n>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_),i=Math.min(e[0][0],e[1][0],e[2][0]),Math.max(e[0][0],e[1][0],e[2][0])-i<this.sourceWorldWidth_/2)&&(t.source=e)}.bind(this))}o={}}addTriangle_(t,e,i,n,s,r){this.triangles_.push({source:[n,s,r],target:[t,e,i]})}addQuad_(e,i,n,s,r,o,a,h,l){const d=xt([r,o,a,h]),u=this.sourceWorldWidth_?Y(d)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&.5<u&&u<1;let _=!1;if(!(!(_=0<l&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(_=.25<Y(xt([e,i,n,s]))/this.targetWorldWidth_||_),!g)&&this.sourceProj_.isGlobal()&&u?.25<u||_:_)&&this.maxSourceExtent_&&isFinite(d[0])&&isFinite(d[1])&&isFinite(d[2])&&isFinite(d[3]))||_t(d,this.maxSourceExtent_)){let t=0;if(!(_||isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(h[0])&&isFinite(h[1])))if(0<l)_=!0;else if(1!=(t=(isFinite(r[0])&&isFinite(r[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(h[0])&&isFinite(h[1])?0:1))&&2!=t&&4!=t&&8!=t)return;if(0<l){if(!_){const i=[(e[0]+n[0])/2,(e[1]+n[1])/2],s=this.transformInv_(i);var m=g?(Zt(r[0],c)+Zt(a[0],c))/2-Zt(s[0],c):(r[0]+a[0])/2-s[0];const h=(r[1]+a[1])/2-s[1];_=m*m+h*h>this.errorThresholdSquared_}if(_){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const d=[(i[0]+n[0])/2,(i[1]+n[1])/2],u=this.transformInv_(d),c=[(s[0]+e[0])/2,(s[1]+e[1])/2],g=this.transformInv_(c);this.addQuad_(e,i,d,c,r,o,u,g,l-1),this.addQuad_(c,d,n,s,g,u,a,h,l-1)}else{const d=[(e[0]+i[0])/2,(e[1]+i[1])/2],u=this.transformInv_(d),c=[(n[0]+s[0])/2,(n[1]+s[1])/2],g=this.transformInv_(c);this.addQuad_(e,d,c,s,r,u,g,h,l-1),this.addQuad_(d,i,n,c,u,o,a,g,l-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&t)&&this.addTriangle_(e,n,s,r,a,h),0==(14&t)&&this.addTriangle_(e,n,i,r,a,o),t&&(0==(13&t)&&this.addTriangle_(i,s,e,o,h,r),0==(7&t))&&this.addTriangle_(i,s,n,o,h,a)}}calculateSourceExtent(){const n=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(t,e,i){t=t.source;Mt(n,t[0]),Mt(n,t[1]),Mt(n,t[2])}),n}getTriangles(){return this.triangles_}}(i,t,a,c,d*(void 0!==l?l:.5),s),0===this.triangulation_.getTriangles().length)this.state=4;else{this.sourceZ_=e.getZForResolution(d);let t=this.triangulation_.calculateSourceExtent();if(c&&(i.canWrapX()?(t[1]=E(t[1],c[1],c[3]),t[3]=E(t[3],c[1],c[3])):t=zt(t,c)),Pt(t)){const i=e.getTileRangeForExtentAndZ(t,this.sourceZ_);for(let e=i.minX;e<=i.maxX;e++)for(let t=i.minY;t<=i.maxY;t++){const i=h(this.sourceZ_,e,t,o);i&&this.sourceTiles_.push(i)}0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}}}getImage(){return this.canvas_}reproject_(){const n=[];var t,e,i,s,r;this.sourceTiles_.forEach(function(t,e,i){t&&2==t.getState()&&n.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),(this.sourceTiles_.length=0)===n.length?this.state=3:(i=this.wrappedTileCoord_[0],t="number"==typeof(e=this.targetTileGrid_.getTileSize(i))?e:e[0],e="number"==typeof e?e:e[1],i=this.targetTileGrid_.getResolution(i),s=this.sourceTileGrid_.getResolution(this.sourceZ_),r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),this.canvas_=function(t,e,_,m,p,i,n,s,a,r,f){const v=w(Math.round(_*t),Math.round(_*e),hs);if(f||(v.imageSmoothingEnabled=!1),0!==s.length){v.scale(_,_),v.globalCompositeOperation="lighter";const y=[1/0,1/0,-1/0,-1/0],o=(s.forEach(function(t,e,i){var n=y;(t=t.extent)[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3])}),Y(y)),h=N(y),C=w(Math.round(_*o/m),Math.round(_*h/m)),l=(f||(C.imageSmoothingEnabled=!1),_/m),S=(s.forEach(function(t,e,i){var n=t.extent[0]-y[0],s=-(t.extent[3]-y[3]),r=Y(t.extent),o=N(t.extent);0<t.image.width&&0<t.image.height&&C.drawImage(t.image,a,a,t.image.width-2*a,t.image.height-2*a,n*l,s*l,r*l,o*l)}),Wt(i));function x(t){return Math.round(t*_)/_}n.getTriangles().forEach(function(t,e,i){var n=t.source,t=t.target,s=n[0][0],r=n[0][1],o=n[1][0],a=n[1][1],h=n[2][0],n=n[2][1],l=x((t[0][0]-S[0])/p),d=x(-(t[0][1]-S[1])/p),u=x((t[1][0]-S[0])/p),c=x(-(t[1][1]-S[1])/p),g=x((t[2][0]-S[0])/p),t=x(-(t[2][1]-S[1])/p),o=function(s){const r=s.length;for(let n=0;n<r;n++){let e=n,i=Math.abs(s[n][n]);for(let t=n+1;t<r;t++){const r=Math.abs(s[t][n]);r>i&&(i=r,e=t)}if(0===i)return null;var t=s[e];s[e]=s[n],s[n]=t;for(let e=n+1;e<r;e++){var o=-s[e][n]/s[n][n];for(let t=n;t<r+1;t++)n==t?s[e][t]=0:s[e][t]+=o*s[n][t]}}var i=new Array(r);for(let e=r-1;0<=e;e--){i[e]=s[e][r]/s[e][e];for(let t=e-1;0<=t;t--)s[t][r]-=s[t][e]*i[e]}return i}([[o-=s,a-=r,0,0,u-l],[h-=s,n-=r,0,0,g-l],[0,0,o,a,c-d],[0,0,h,n,t-d]]);if(o){if(v.save(),v.beginPath(),void 0===as&&((a=document.createElement("canvas").getContext("2d")).globalCompositeOperation="lighter",a.fillStyle="rgba(210, 0, 0, 0.75)",ls(a,4,5,4,0),ls(a,4,5,0,5),a=a.getImageData(0,0,3,3).data,as=ds(a,0)||ds(a,4)||ds(a,8)),as||!f){v.moveTo(u,c);const t=4,e=l-u,_=d-c;for(let t=0;t<4;t++)v.lineTo(u+x((t+1)*e/4),c+x(t*_/3)),3!=t&&v.lineTo(u+x((t+1)*e/4),c+x((t+1)*_/3))}else v.moveTo(u,c),v.lineTo(l,d);v.lineTo(g,t),v.clip(),v.transform(o[0],o[2],o[1],o[3],l,d),v.translate(y[0]-s,y[3]-r),v.scale(m/_,-m/_),v.drawImage(C.canvas,0,0),v.restore()}}),r&&(v.save(),v.globalCompositeOperation="source-over",v.strokeStyle="black",v.lineWidth=1,n.getTriangles().forEach(function(t,e,i){var t=t.target,n=(t[0][0]-S[0])/p,s=-(t[0][1]-S[1])/p,r=(t[1][0]-S[0])/p,o=-(t[1][1]-S[1])/p,a=(t[2][0]-S[0])/p,t=-(t[2][1]-S[1])/p;v.beginPath(),v.moveTo(r,o),v.lineTo(n,s),v.lineTo(a,t),v.closePath(),v.stroke()}),v.restore())}return v.canvas}(t,e,this.pixelRatio_,s,(this.sourceTileGrid_.getExtent(),i),r,this.triangulation_,n,this.gutter_,this.renderEdges_,this.interpolate),this.state=2),this.changed()}load(){if(0==this.state){this.state=1,this.changed();let s=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(i,n,t){var e=i.getState();if(0==e||1==e){s++;const n=r(i,o,function(t){var e=i.getState();2!=e&&3!=e&&4!=e||(a(n),0===--s&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}.bind(this)),0===s?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,e,i){0==t.getState()&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(a),this.sourcesListenerKeys_=null}release(){this.canvas_&&(be(this.canvas_.getContext("2d")),hs.push(this.canvas_),this.canvas_=null),super.release()}};function gs(t,e,i,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=i,n):[t,e,i]}function _s(t,e,i){return t+"/"+e+"/"+i}function ms(t){return _s(t[0],t[1],t[2])}const ps=class extends class{constructor(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return 0<this.highWaterMark&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){t=this.entries_[t];return d(void 0!==t,15),t!==this.newest_&&(t===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(t.newer.older=t.older,t.older.newer=t.newer),t.newer=null,t.older=this.newest_,this.newest_.newer=t,this.newest_=t),t.value_}remove(t){var e=this.entries_[t];return d(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){var t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){var t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){d(!(t in this.entries_),16);e={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=e:this.oldest_=e,this.newest_=e,this.entries_[t]=e,++this.count_}setSize(t){this.highWaterMark=t}}{clear(){for(;0<this.getCount();)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(0!==this.getCount()){const e=this.peekFirstKey().split("/").map(Number)[0];this.forEach(function(t){t.tileCoord[0]!==e&&(this.remove(ms(t.tileCoord)),t.release())}.bind(this))}}};function fs(e){return e?Array.isArray(e)?function(t){return e}:"function"==typeof e?e:function(t){return[e]}:null}_=class extends e{constructor(t){super(),this.projection=f(t.projection),this.attributions_=fs(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:"ready",this.wrapX_=void 0!==t.wrapX&&t.wrapX,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const i=this;this.viewPromise_=new Promise(function(t,e){i.viewResolver=t,i.viewRejector=e})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return h()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=fs(t),this.changed()}setState(t){this.state_=t,this.changed()}};class vs{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function xs(t,e,i,n,s){return void 0!==s?(s.minX=t,s.maxX=e,s.minY=i,s.maxY=n,s):new vs(t,e,i,n)}const ys=vs,Cs=[0,0,0],Ss=class{constructor(t){let i;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,d(function(i){const n=function(t,e){return e-t};return i.every(function(t,e){return 0===e||!(0<(e=n(i[e-1],t))||0===e)})}(this.resolutions_),17),!t.origins)for(let t=0,e=this.resolutions_.length-1;t<e;++t)if(i){if(this.resolutions_[t]/this.resolutions_[t+1]!==i){i=void 0;break}}else i=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,d(this.origins_.length==this.resolutions_.length,20));const n=t.extent;void 0===n||this.origin_||this.origins_||(this.origin_=Wt(n)),d(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,d(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:256,d(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==n?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){var i=new ys(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(n){const t=this.getTileRangeForExtentAndZ(n,e);i.minX=Math.max(t.minX,i.minX),i.maxX=Math.min(t.maxX,i.maxX),i.minY=Math.max(t.minY,i.minY),i.maxY=Math.min(t.maxY,i.maxY)}return i},this):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,n,s){var r=this.getTileRangeForExtentAndZ(t,n);for(let i=r.minX,t=r.maxX;i<=t;++i)for(let t=r.minY,e=r.maxY;t<=e;++t)s([n,i,t])}forEachTileCoordParentTileRange(t,e,i,n){let s,r,o,a=null,h=t[0]-1;for(2===this.zoomFactor_?(r=t[1],o=t[2]):a=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(s=2===this.zoomFactor_?(r=Math.floor(r/2),o=Math.floor(o/2),xs(r,r,o,o,i)):this.getTileRangeForExtentAndZ(a,h,i),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_||this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],n=2*t[2];return xs(i,1+i,n,1+n,e)}i=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;var n=t[0],s=t[1],r=t[2];if(e===n)return xs(s,r,s,r,i);if(this.zoomFactor_){const t=Math.pow(this.zoomFactor_,e-n),o=Math.floor(s*t),a=Math.floor(r*t);return e<n?xs(o,o,a,a,i):xs(o,Math.floor(t*(s+1))-1,a,Math.floor(t*(r+1))-1,i)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,i)}getTileRangeExtent(t,e,i){var n=this.getOrigin(t),s=this.getResolution(t),t=C(this.getTileSize(t),this.tmpSize_),r=n[0]+e.minX*t[0]*s,o=n[0]+(e.maxX+1)*t[0]*s;return x(r,n[1]+e.minY*t[1]*s,o,n[1]+(e.maxY+1)*t[1]*s,i)}getTileRangeForExtentAndZ(t,e,i){var n=Cs,s=(this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n),n[1]),r=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),xs(s,n[1],r,n[2],i)}getTileCoordCenter(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=C(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){var i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=C(this.getTileSize(t[0]),this.tmpSize_),r=i[0]+t[1]*s[0]*n,i=i[1]-(t[2]+1)*s[1]*n;return x(r,i,r+s[0]*n,i+s[1]*n,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,s){var r=this.getZForResolution(i),o=i/this.getResolution(r),a=this.getOrigin(r),h=C(this.getTileSize(r),this.tmpSize_);let l=o*(t-a[0])/i/h[0],d=o*(a[1]-e)/i/h[1];return d=n?(l=qt(l,5)-1,qt(d,5)-1):(l=Ut(l,5),Ut(d,5)),gs(r,l,d,s)}getTileCoordForXYAndZ_(t,e,i,n,s){var r=this.getOrigin(i),o=this.getResolution(i),a=C(this.getTileSize(i),this.tmpSize_);let h=(t-r[0])/o/a[0],l=(r[1]-e)/o/a[1];return l=n?(h=qt(h,5)-1,qt(l,5)-1):(h=Ut(h,5),Ut(l,5)),gs(i,h,l,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_||this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){return E(M(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return fn(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(e){var i=this.resolutions_.length,n=new Array(i);for(let t=this.minZoom;t<i;++t)n[t]=this.getTileRangeForExtentAndZ(e,t);this.fullTileRanges_=n}};function ws(t){let e=t.getDefaultTileGrid();return e||(e=(i=Ts(t),n=Es(i,void 0,void 0),new Ss({extent:i,origin:function(t,e){let i;return"bottom-left"===e?i=kt(t):"bottom-right"===e?i=At(t):"top-left"===e?i=Wt(t):"top-right"===e?i=Xt(t):d(!1,13),i}(i,"top-left"),resolutions:n,tileSize:void 0})),t.setDefaultTileGrid(e)),e;var i,n}function Es(t,e,i,n){e=void 0!==e?e:42,i=C(void 0!==i?i:256);var s=N(t),t=Y(t),r=(n=0<n?n:Math.max(t/i[0],s/i[1]),e+1),o=new Array(r);for(let t=0;t<r;++t)o[t]=n/Math.pow(2,t);return o}function Ts(t){let e=(t=f(t)).getExtent();return e||(t=180*ai.degrees/t.getMetersPerUnit(),e=x(-t,-t,t,t)),e}class Rs extends t{constructor(t,e){super(t),this.tile=e}}p=class extends _{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,this.tileGrid&&C(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tileCache=new ps(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection||0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){t=this.getTileCacheForProjection(t);t&&t.expireCache(e)}forEachLoadedTile(t,i,n,s){var r=this.getTileCacheForProjection(t);if(!r)return!1;let o,a,h,l=!0;for(let e=n.minX;e<=n.maxX;++e)for(let t=n.minY;t<=n.maxY;++t)a=_s(i,e,t),h=!1,r.containsKey(a)&&(o=r.get(a),h=(h=2===o.getState())&&!1!==s(o)),h||(l=!1);return l}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,i,n,s){return h()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid||ws(t)}getTileCacheForProjection(t){var e=this.getProjection();return d(null===e||ki(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){var i=this.getTileGridForProjection(i),e=this.getTilePixelRatio(e),i=C(i.getTileSize(t),this.tmpSize);return 1==e?i:((t=void 0===(t=this.tmpSize)?[0,0]:t)[0]=(i=i)[0]*(e=e)+.5|0,t[1]=i[1]*e+.5|0,t)}getTileCoordForTileUrlFunction(t,e){e=void 0!==e?e:this.getProjection();var i=this.getTileGridForProjection(e);return function(t,e){var i=t[0],n=t[1],t=t[2];if(!(e.getMinZoom()>i||i>e.getMaxZoom()))return!(e=e.getFullTileRange(i))||e.containsXY(n,t)}(t=this.getWrapX()&&e.isGlobal()?function(t,e,i){var n=e[0],s=t.getTileCoordCenter(e),r=Ts(i);if(wt(r,s))return e;{const e=Y(r),i=Math.ceil((r[0]-s[0])/e);return s[0]+=e*i,t.getTileCoordForCoordAndZ(s,n)}}(i,t,e):t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){e=this.getTileCacheForProjection(e);t>e.highWaterMark&&(e.highWaterMark=t)}useTile(t,e,i,n){}};function Is(t,e){t.getImage().src=e}const bs=class extends class Zr extends p{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Zr.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){var e=z(t=t.target),i=t.getState();let n;1==i?(this.tileLoadingKeys_[e]=!0,n="tileloadstart"):e in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[e],n=3==i?"tileloaderror":2==i?"tileloadend":void 0),null!=n&&this.dispatchEvent(new Rs(n,t))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){t=function(e){var i=[];let n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var s=n[1].charCodeAt(0),r=n[2].charCodeAt(0);let t;for(t=s;t<=r;++t)i.push(e.replace(n[0],String.fromCharCode(t)))}else if(n=/\{(\d+)-(\d+)\}/.exec(e)){var o=parseInt(n[2],10);for(let t=parseInt(n[1],10);t<=o;t++)i.push(e.replace(n[0],t.toString()))}else i.push(e);return i}(t),this.urls=t,this.setUrls(t)}setUrls(t){var e=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(e,i){var s,n=e.length,r=new Array(n);for(let t=0;t<n;++t)r[t]=function(n,s){const r=/\{z\}/g,o=/\{x\}/g,a=/\{y\}/g,h=/\{-y\}/g;return function(e,t,i){return e?n.replace(r,e[0].toString()).replace(o,e[1].toString()).replace(a,e[2].toString()).replace(h,function(){var t=e[0];return d(t=s.getFullTileRange(t),55),(t.getHeight()-e[2]-1).toString()}):void 0}}(e[t],i);return 1===(s=r).length?s[0]:function(t,e,i){var n;if(t)return n=Zt((t[1]<<t[0])+t[2],s.length),s[n](t,e,i)}}(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){t=_s(t,e,i),this.tileCache.containsKey(t)&&this.tileCache.get(t)}}{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction||Is,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:void 0===t.interpolate||t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:os,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){var i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const t in this.tileCacheForProjection){var n=this.tileCacheForProjection[t];n.expireCache(n==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!ki(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return!(this.getProjection()&&t&&!ki(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(!this.tileGrid||e&&!ki(e,t)){const e=z(t);return e in this.tileGridForProjection||(this.tileGridForProjection[e]=ws(t)),this.tileGridForProjection[e]}return this.tileGrid}getTileCacheForProjection(t){const e=this.getProjection();if(!e||ki(e,t))return this.tileCache;{const e=z(t);return e in this.tileCacheForProjection||(this.tileCacheForProjection[e]=new ps(this.tileCache.highWaterMark)),this.tileCacheForProjection[e]}}createTile_(t,e,i,n,s,r){t=[t,e,i],e=this.getTileCoordForTileUrlFunction(t,s),i=e?this.tileUrlFunction(e,n,s):void 0,e=new this.tileClass(t,void 0!==i?0:4,void 0!==i?i:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return e.key=r,e.addEventListener(o,this.handleTileChange.bind(this)),e}getTile(e,i,n,s,r){const o=this.getProjection();if(o&&r&&!ki(o,r)){var a=this.getTileCacheForProjection(r),h=[e,i,n];let t;var l=ms(h),d=(a.containsKey(l)&&(t=a.get(l)),this.getKey());if(t&&t.key==d)return t;{const e=this.getTileGridForProjection(o),i=this.getTileGridForProjection(r),n=this.getTileCoordForTileUrlFunction(h,r),u=new cs(o,e,r,i,h,n,this.getTilePixelRatio(s),this.getGutter(),function(t,e,i,n){return this.getTileInternal(t,e,i,n,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return u.key=d,t?(u.interimTile=t,u.refreshInterimChain(),a.replace(l,u)):a.set(l,u),u}}return this.getTileInternal(e,i,n,s,o||r)}getTileInternal(t,e,i,n,s){let r=null;var o,a=_s(t,e,i),h=this.getKey();return this.tileCache.containsKey(a)?(r=this.tileCache.get(a)).key!=h&&(o=r,r=this.createTile_(t,e,i,n,s,h),0==o.getState()?r.interimTile=o.interimTile:r.interimTile=o,r.refreshInterimChain(),this.tileCache.replace(a,r)):(r=this.createTile_(t,e,i,n,s,h),this.tileCache.set(a,r)),r}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){var i=f(t);if(i){const t=z(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}},Ms=class extends bs{constructor(t){const e=void 0!==(t=t||{}).projection?t.projection:"EPSG:3857",i=void 0!==t.tileGrid?t.tileGrid:(n={extent:Ts(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize},s={extent:s=n.extent||f("EPSG:3857").getExtent(),minZoom:n.minZoom,tileSize:n.tileSize,resolutions:Es(s,n.maxZoom,n.tileSize,n.maxResolution)},new Ss(s));var n,s;super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0}getGutter(){return this.gutter_}},Fs=class extends Ms{constructor(t){var e=void 0!==(t=t||{}).attributions?t.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'],i=void 0!==t.crossOrigin?t.crossOrigin:"anonymous",n=void 0!==t.url?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:void 0!==t.maxZoom?t.maxZoom:19,opaque:void 0===t.opaque||t.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}},Ls="preload",Ps="useInterimTilesOnError",ks=class extends pe{constructor(t){t=t||{};var e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(Ls)}setPreload(t){this.set(Ls,t)}getUseInterimTilesOnError(){return this.get(Ps)}setUseInterimTilesOnError(t){this.set(Ps,t)}getData(t){return super.getData(t)}},As=class extends J{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return h()}getData(t){return null}prepareFrame(t){return h()}renderFrame(t,e){return h()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(n,s,r){return function(t,e){var i=this.loadedTileCallback.bind(this,r,t);return n.forEachLoadedTile(s,t,e,i)}.bind(this)}forEachFeatureAtCoordinate(t,e,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){2===t.target.getState()&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return 2!=e&&3!=e&&t.addEventListener(o,this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e}renderIfReadyAndVisible(){var t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},Ds=[];let Os=null;const Gs=class extends As{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let n;var s;Os||((s=document.createElement("canvas")).width=1,s.height=1,Os=s.getContext("2d")),Os.clearRect(0,0,1,1);try{Os.drawImage(t,e,i,1,1,0,0,1,1),n=Os.getImageData(0,0,1,1).data}catch(t){return Os=null}return n}getBackground(t){let e=this.getLayer().getBackground();return(e="function"==typeof e?e(t.viewState.resolution):e)||void 0}useContainer(t,e,i){var n=this.getLayer().getClassName();let s,r;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&gt(te(t.style.backgroundColor),te(i)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(r=e.getContext("2d"))}if(r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(s=document.createElement("div")).className=n;let t=s.style;t.position="absolute",t.width="100%",t.height="100%";const e=(r=w()).canvas;s.appendChild(e),(t=e.style).position="absolute",t.left="0",t.transformOrigin="top left",this.container=s,this.context=r}this.containerReused||!i||this.container.style.backgroundColor||(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){var n=Wt(i),s=Xt(i),r=At(i),i=kt(i),e=(W(e.coordinateToPixelTransform,n),W(e.coordinateToPixelTransform,s),W(e.coordinateToPixelTransform,r),W(e.coordinateToPixelTransform,i),this.inversePixelTransform);W(e,n),W(e,s),W(e,r),W(e,i),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.clip()}dispatchRenderEvent_(t,e,i){var n=this.getLayer();n.hasListener(t)&&(t=new we(t,this.inversePixelTransform,i,e),n.dispatchEvent(t))}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)}postRender(t,e){this.dispatchRenderEvent_("postrender",t,e)}getRenderTransform(t,e,i,n,s,r,o){n/=e,e=-t[0]+o,o=-t[1];return X(this.tempTransform,s/2,r/2,n,-n,-i,e,o)}disposeInternal(){delete this.frameState,super.disposeInternal()}},zs=class extends Gs{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new ys(0,0,0,0)}isDrawableTile(t){var e=this.getLayer(),t=t.getState(),e=e.getUseInterimTilesOnError();return 2==t||4==t||3==t&&!e}getTile(t,e,i,n){var s=n.pixelRatio,n=n.viewState.projection,r=this.getLayer();let o=r.getSource().getTile(t,e,i,s,n);return 3==o.getState()&&r.getUseInterimTilesOnError()&&0<r.getPreload()&&(this.newTiles_=!0),o=this.isDrawableTile(o)?o:o.getInterimTile()}getData(t){const e=this.frameState;if(e){const h=this.getLayer(),l=W(e.pixelToCoordinateTransform,t.slice()),d=h.getExtent();if(!d||wt(d,l)){var i=e.pixelRatio,n=e.viewState.projection,s=e.viewState,r=h.getRenderSource(),o=r.getTileGridForProjection(s.projection),a=r.getTilePixelRatio(e.pixelRatio);for(let t=o.getZForResolution(s.resolution);t>=o.getMinZoom();--t){const e=o.getTileCoordForCoordAndZ(l,t),h=r.getTile(t,e[1],e[2],i,n);if(!(h instanceof os||h instanceof cs)||h instanceof cs&&4===h.getState())return null;if(2===h.getState()){const d=o.getOrigin(t),u=C(o.getTileSize(t)),c=o.getResolution(t),g=Math.floor(a*((l[0]-d[0])/c-e[1]*u[0])),_=Math.floor(a*((d[1]-l[1])/c-e[2]*u[1])),m=Math.round(a*r.getGutterForProjection(s.projection));return this.getImageData(h.getImage(),g+m,_+m)}}}}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(n,s){const r=n.layerStatesArray[n.layerIndex],e=n.viewState,o=e.projection,a=e.resolution,h=e.center,l=e.rotation,d=n.pixelRatio,u=this.getLayer(),c=u.getSource(),g=c.getRevision(),_=c.getTileGridForProjection(o),m=_.getZForResolution(a,c.zDirection),p=_.getResolution(m);let f=n.extent;const v=n.viewState.resolution,x=c.getTilePixelRatio(d),y=Math.round(Y(f)/v*d),C=Math.round(N(f)/v*d),S=r.extent&&r.extent,w=(S&&(f=zt(f,r.extent)),p*y/2/x),t=p*C/2/x,i=[h[0]-w,h[1]-t,h[0]+w,h[1]+t],E=_.getTileRangeForExtentAndZ(f,m),T={};T[m]={};var R=this.createLoadedTileFinder(c,o,T),I=this.tmpExtent,b=this.tmpTileRange_,O=(this.newTiles_=!1,l?Gt(e.center,v,l,n.size):void 0);for(let i=E.minX;i<=E.maxX;++i)for(let e=E.minY;e<=E.maxY;++e)if(!l||_.tileCoordIntersectsViewport([m,i,e],O)){const G=this.getTile(m,i,e,n);if(this.isDrawableTile(G)){const s=z(this);if(2==G.getState()){let t=(T[m][G.tileCoord.toString()]=G).inTransition(s);t&&1!==r.opacity&&(G.endTransition(s),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(G)||(this.newTiles_=!0)}if(1===G.getAlpha(s,n.time))continue}const o=_.getTileCoordChildTileRange(G.tileCoord,b,I);let t=!1;(t=o?R(m+1,o):t)||_.forEachTileCoordParentTileRange(G.tileCoord,R,b,I)}var M=p/a*d/x,F=(X(this.pixelTransform,n.size[0]/2,n.size[1]/2,1/d,1/d,l,-y/2,-C/2),vt(this.pixelTransform)),L=(this.useContainer(s,F,this.getBackground(n)),this.context),s=L.canvas;pt(this.inversePixelTransform,this.pixelTransform),X(this.tempTransform,y/2,C/2,M,M,0,-y/2,-C/2),s.width!=y||s.height!=C?(s.width=y,s.height=C):this.containerReused||L.clearRect(0,0,y,C),S&&this.clipUnrotated(L,n,S),c.getInterpolate()||(L.imageSmoothingEnabled=!1),this.preRender(L,n),this.renderedTiles.length=0;let P,k,A,D=Object.keys(T).map(Number);D.sort(G),1!==r.opacity||this.containerReused&&!c.getOpaque(n.viewState.projection)?(P=[],k=[]):D=D.reverse();for(let t=D.length-1;0<=t;--t){const r=D[t],e=c.getTilePixelSize(r,d,o),G=_.getResolution(r)/p,a=e[0]*G*M,h=e[1]*G*M,l=_.getTileCoordForCoordAndZ(Wt(i),r),u=_.getTileCoordExtent(l),g=W(this.tempTransform,[x*(u[0]-i[0])/p,x*(i[3]-u[3])/p]),f=x*c.getGutterForProjection(o),v=T[r];for(const s in v){const e=v[s],G=e.tileCoord,o=l[1]-G[1],d=Math.round(g[0]-(o-1)*a),u=l[2]-G[2],_=Math.round(g[1]-(u-1)*h),p=Math.round(g[0]-o*a),x=Math.round(g[1]-u*h),y=d-p,C=_-x,S=m===r,w=S&&1!==e.getAlpha(z(this),n.time);let i=!1;if(!w)if(P){A=[p,x,p+y,x,p+y,x+C,p,x+C];for(let t=0,e=P.length;t<e;++t)if(m!==r&&r<k[t]){const s=P[t];_t([p,x,p+y,x+C],[s[0],s[3],s[4],s[7]])&&(i||(L.save(),i=!0),L.beginPath(),L.moveTo(A[0],A[1]),L.lineTo(A[2],A[3]),L.lineTo(A[4],A[5]),L.lineTo(A[6],A[7]),L.moveTo(s[6],s[7]),L.lineTo(s[4],s[5]),L.lineTo(s[2],s[3]),L.lineTo(s[0],s[1]),L.clip())}P.push(A),k.push(r)}else L.clearRect(p,x,y,C);this.drawTileImage(e,n,p,x,y,C,f,S),P&&!w?(i&&L.restore(),this.renderedTiles.unshift(e)):this.renderedTiles.push(e),this.updateUsedTiles(n.usedTiles,c,e)}}return this.renderedRevision=g,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!bt(this.renderedExtent_,i),this.renderedExtent_=i,this.renderedPixelRatio=d,this.renderedProjection=o,this.manageTilePyramid(n,c,_,d,o,f,m,u.getPreload()),this.scheduleExpireCache(n,c),this.postRender(L,n),r.extent&&L.restore(),L.imageSmoothingEnabled=!0,F!==s.style.transform&&(s.style.transform=F),this.container}drawTileImage(t,e,i,n,s,r,o,a){var h,l,d,u,c=this.getTileImage(t);c&&(h=z(this),(u=(d=(l=e.layerStatesArray[e.layerIndex]).opacity*(a?t.getAlpha(h,e.time):1))!==this.context.globalAlpha)&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(c,o,o,c.width-2*o,c.height-2*o,i,n,s,r),u&&this.context.restore(),d!==l.opacity?e.animate=!0:a&&t.endTransition(h))}getImage(){var t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){e.canExpireCache()&&(e=function(t,e,i){var n=z(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}.bind(null,e),t.postRenderFunctions.push(e))}updateUsedTiles(t,e,i){e=z(e);e in t||(t[e]={}),t[e][i.getKey()]=!0}manageTilePyramid(t,e,i,n,s,r,o,a,h){var l=z(e),d=(l in t.wantedTiles||(t.wantedTiles[l]={}),t.wantedTiles[l]),u=t.tileQueue,c=i.getMinZoom(),g=t.viewState.rotation,_=g?Gt(t.viewState.center,t.viewState.resolution,g,t.size):void 0;let m,p,f,v,x,y,C=0;for(y=c;y<=o;++y)for(p=i.getTileRangeForExtentAndZ(r,y,p),f=i.getResolution(y),v=p.minX;v<=p.maxX;++v)for(x=p.minY;x<=p.maxY;++x)g&&!i.tileCoordIntersectsViewport([y,v,x],_)||(o-y<=a?(++C,0==(m=e.getTile(y,v,x,n,s)).getState()&&(d[m.getKey()]=!0,u.isKeyQueued(m.getKey())||u.enqueue([m,l,i.getTileCoordCenter(m.tileCoord),f])),void 0!==h&&h(m)):e.useTile(y,v,x,s));e.updateCacheSize(C,s)}},Ws=class extends ks{constructor(t){super(t)}createRenderer(){return new zs(this)}};var Xs=$r(582);p=class Kr{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=C(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){var t=this.getScale();return new Kr({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return h()}getImage(t){return h()}getHitDetectionImage(){return h()}getPixelRatio(t){return 1}getImageState(){return h()}getImageSize(){return h()}getOrigin(){return h()}getSize(){return h()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=C(t)}listenImageChange(t){h()}load(){h()}unlistenImageChange(t){h()}};function S(t){return Array.isArray(t)?ie(t):t}const Ns=class Vr extends p{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){var t=this.getScale();return(t=new Vr({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})).setOpacity(this.getOpacity()),t}getAnchor(){var t,e,i=this.size_;return i?(t=this.getDisplacement(),e=this.getScaleArray(),[i[0]/2-t[0]/e[0],i[1]/2+t[1]/e[1]]):null}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];var i,n;return e||(n=w((i=this.renderOptions_).size*t,i.size*t),this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e),e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return 2}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;let n=this.radius_,s=void 0===this.radius2_?n:this.radius2_;if(n<s){const t=n;n=s,s=t}var r=void 0===this.radius2_?this.points_:2*this.points_,r=2*Math.PI/r,o=s*Math.sin(r),a=n-Math.sqrt(s*s-o*o),h=Math.sqrt(o*o+a*a),o=h/o;if("miter"===t&&o<=i)return o*e;if(o=e/2/o,a=e/2*(a/h),h=Math.sqrt((n+o)*(n+o)+a*a)-n,void 0!==this.radius2_&&"bevel"!==t&&(o=n*Math.sin(r),a=s-Math.sqrt(n*n-o*o),(r=Math.sqrt(o*o+a*a)/o)<=i)){const t=r*e/2-s-n;return 2*Math.max(h,t)}return 2*h}createRenderOptions(){let t,e=Ae,i=0,n=null,s=0,r=0;this.stroke_&&(t=S(t=null===(t=this.stroke_.getColor())?De:t),void 0===(r=this.stroke_.getWidth())&&(r=1),n=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=Ae),void 0===(i=this.stroke_.getMiterLimit()))&&(i=10);var o=this.calculateLineJoinSize_(e,r,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*a+o),lineDash:n,lineDashOffset:s,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=m),e.fillStyle=S(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(i){if(this.fill_){let t=this.fill_.getColor(),e=0;var n;null===(t="string"==typeof t?te(t):t)?e=1:Array.isArray(t)&&(e=4===t.length?t[3]:1),0===e&&(n=w(i.size,i.size),this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(i,n))}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let i=this.points_;var n=this.radius_;if(i===1/0)e.arc(0,0,n,0,2*Math.PI);else{var s=void 0===this.radius2_?n:this.radius2_,r=(void 0!==this.radius2_&&(i*=2),this.angle_-Math.PI/2),o=2*Math.PI/i;for(let t=0;t<i;t++){const i=r+t*o,a=t%2==0?n:s;e.lineTo(a*Math.cos(i),a*Math.sin(i))}e.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=m,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}};class Ys extends Ns{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){var t=this.getScale(),t=new Ys({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(t){this.radius_=t,this.render()}}const Bs=Ys;const js=class Ur{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null}clone(){var t=this.getColor();return new Ur({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}};const Zs=class qr{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){var t=this.getColor();return new qr({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}};class Ks{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=qs,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new Ks({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=qs,this.geometry_=e}setZIndex(t){this.zIndex_=t}}let Vs=null;function Us(t,e){if(!Vs){const t=new js({color:"rgba(255,255,255,0.4)"}),e=new Zs({color:"#3399CC",width:1.25});Vs=[new Ks({image:new Bs({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Vs}function qs(t){return t.getGeometry()}const Hs=Ks;let Js=null;class Qs extends O{constructor(t,e,i,n,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&2===this.imageState_){(Js=Js||w(1,1)).drawImage(this.image_,0,0);try{Js.getImageData(0,0,1,1),this.tainted_=!1}catch(t){Js=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(o)}handleImageError_(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]||this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){var t,e,i;return this.image_||this.initializeImage_(),this.hitDetectionImage_||(this.isTainted_()?((i=w(t=this.size_[0],e=this.size_[1])).fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas):this.hitDetectionImage_=this.image_),this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(0===this.imageState_){this.image_||this.initializeImage_(),this.imageState_=1;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=rs(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){var e,i,n;this.color_&&!this.canvas_[t]&&2===this.imageState_&&(e=this.image_,(i=document.createElement("canvas")).width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t),(n=i.getContext("2d")).scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Qt(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i)}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}const $s=class Hr extends p{constructor(t){var e=void 0!==(t=t||{}).opacity?t.opacity:1,i=void 0!==t.rotation?t.rotation:0,n=void 0!==t.scale?t.scale:1,s=void 0!==t.rotateWithView&&t.rotateWithView,e=(super({opacity:e,rotation:i,scale:n,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:"fraction",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null,void 0!==t.img?t.img:null);this.imgSize_=t.imgSize;let r=t.src;d(!(void 0!==r&&e),4),d(!e||this.imgSize_,5),d(void 0!==(r=void 0!==r&&0!==r.length||!e?r:e.src||z(e))&&0<r.length,6),i=void 0!==t.src?0:2,this.color_=void 0!==t.color?te(t.color):null,this.iconImage_=function(t,e,i,n,s,r){let o=se.get(e,n,r);return o||(o=new Qs(t,e,i,n,s,r),se.set(e,n,r,o)),o}(e,r,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,i,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==t.size?t.size:null}clone(){var t=this.getScale();return new Hr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const e=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(t[0]*=e[0]),"fraction"==this.anchorYUnits_&&(t[1]*=e[1])}if("top-left"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[0]=-t[0]+e[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(!this.origin_){let t=this.offset_;if("top-left"!=this.offsetOrigin_){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[0]=i[0]-e[0]-t[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(t[1]=i[1]-e[1]-t[1])}this.origin_=t}return this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_||this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(o,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(o,t)}};const tr=class Jr{constructor(t){this.font_=(t=t||{}).font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=C(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new js({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill||null,this.backgroundStroke_=t.backgroundStroke||null,this.padding_=void 0===t.padding?null:t.padding}clone(){var t=this.getScale();return new Jr({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=C(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}};function er(t){return new Hs({fill:ir(t,""),stroke:nr(t,""),text:function(t){var e=t["text-value"];if(e)return new tr({text:e,font:t["text-font"],maxAngle:t["text-max-angle"],offsetX:t["text-offset-x"],offsetY:t["text-offset-y"],overflow:t["text-overflow"],placement:t["text-placement"],scale:t["text-scale"],rotateWithView:t["text-rotate-with-view"],rotation:t["text-rotation"],textAlign:t["text-align"],justify:t["text-justify"],textBaseline:t["text-baseline"],padding:t["text-padding"],fill:ir(t,"text-"),backgroundFill:ir(t,"text-background-"),stroke:nr(t,"text-"),backgroundStroke:nr(t,"text-background-")})}(t),image:function(t){const e=t["icon-src"],i=t["icon-img"];if(e||i)return new $s({src:e,img:i,imgSize:t["icon-img-size"],anchor:t["icon-anchor"],anchorOrigin:t["icon-anchor-origin"],anchorXUnits:t["icon-anchor-x-units"],anchorYUnits:t["icon-anchor-y-units"],color:t["icon-color"],crossOrigin:t["icon-cross-origin"],offset:t["icon-offset"],displacement:t["icon-displacement"],opacity:t["icon-opacity"],scale:t["icon-scale"],rotation:t["icon-rotation"],rotateWithView:t["icon-rotate-with-view"],size:t["icon-size"],declutterMode:t["icon-declutter-mode"]});var n=t["shape-points"];if(n){const e="shape-";return new Ns({points:n,fill:ir(t,"shape-"),stroke:nr(t,"shape-"),radius:t["shape-radius"],radius1:t["shape-radius1"],radius2:t["shape-radius2"],angle:t["shape-angle"],displacement:t["shape-displacement"],rotation:t["shape-rotation"],rotateWithView:t["shape-rotate-with-view"],scale:t["shape-scale"],declutterMode:t["shape-declutter-mode"]})}n=t["circle-radius"];if(n){const e="circle-";return new Bs({radius:n,fill:ir(t,"circle-"),stroke:nr(t,"circle-"),displacement:t["circle-displacement"],scale:t["circle-scale"],rotation:t["circle-rotation"],rotateWithView:t["circle-rotate-with-view"],declutterMode:t["circle-declutter-mode"]})}}(t)})}function ir(t,e){t=t[e+"fill-color"];if(t)return new js({color:t})}function nr(t,e){var i=t[e+"stroke-width"],n=t[e+"stroke-color"];if(i||n)return new Zs({width:i,color:n,lineCap:t[e+"stroke-line-cap"],lineJoin:t[e+"stroke-line-join"],lineDash:t[e+"stroke-line-dash"],lineDashOffset:t[e+"stroke-line-dash-offset"],miterLimit:t[e+"stroke-miter-limit"]})}const sr="renderOrder",rr=class extends pe{constructor(t){t=t||{};var e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(sr)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new Xs(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(sr,t)}setStyle(e){let t;if(void 0===e)t=Us;else if(null===e)t=null;else if("function"==typeof e)t=e;else if(e instanceof Hs)t=e;else if(Array.isArray(e)){var i=e.length,n=new Array(i);for(let t=0;t<i;++t){var s=e[t];n[t]=s instanceof Hs?s:er(s)}t=n}else t=er(e);this.style_=t,this.styleFunction_=null===e?void 0:function(e){let i;if("function"==typeof e)i=e;else{let t;t=Array.isArray(e)?e:(d("function"==typeof e.getZIndex,41),[e]),i=function(){return t}}return i}(this.style_),this.changed()}},or={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ar=[or.FILL],hr=[or.STROKE],lr=[or.BEGIN_PATH],dr=[or.CLOSE_PATH],mt=or,ur=class{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},cr=class extends ur{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})}appendFlatPointCoordinates(i,n){var s=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,o=this.coordinates;let a=o.length;for(let t=0,e=i.length;t<e;t+=n)r[0]=i[t],r[1]=i[t+1],wt(s,r)&&(o[a++]=r[0],o[a++]=r[1]);return a}appendFlatLineCoordinates(t,e,i,n,s,r){var o=this.coordinates;let a=o.length;var h=this.getBufferedMaxExtent();r&&(e+=n);let l=t[e],d=t[e+1];var u=this.tmpCoordinate_;let c,g,_,m=!0;for(c=e+n;c<i;c+=n)u[0]=t[c],u[1]=t[c+1],(_=Rt(h,u))!==g?(m&&(o[a++]=l,o[a++]=d,m=!1),o[a++]=u[0],o[a++]=u[1]):m=1!==_||(o[a++]=u[0],o[a++]=u[1],!1),l=u[0],d=u[1],g=_;return(s&&m||c===e+n)&&(o[a++]=l,o[a++]=d),a}drawCustomCoordinates_(i,n,s,r,o){for(let t=0,e=s.length;t<e;++t){var a=s[t],h=this.appendFlatLineCoordinates(i,n,a,r,!1,!1);o.push(h),n=a}return n}drawCustom(t,i,n,e){this.beginGeometry(t,i);var s=t.getType(),r=t.getStride(),o=this.coordinates.length;let a,h,l,d,u;switch(s){case"MultiPolygon":a=t.getOrientedFlatCoordinates(),d=[];const i=t.getEndss();for(let t=u=0,e=i.length;t<e;++t){const n=[];u=this.drawCustomCoordinates_(a,u,i[t],r,n),d.push(n)}this.instructions.push([mt.CUSTOM,o,d,t,n,dn]),this.hitDetectionInstructions.push([mt.CUSTOM,o,d,t,e||n,dn]);break;case"Polygon":case"MultiLineString":l=[],a="Polygon"==s?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),r,l),this.instructions.push([mt.CUSTOM,o,l,t,n,ln]),this.hitDetectionInstructions.push([mt.CUSTOM,o,l,t,e||n,ln]);break;case"LineString":case"Circle":a=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(a,0,a.length,r,!1,!1),this.instructions.push([mt.CUSTOM,o,h,t,n,hn]),this.hitDetectionInstructions.push([mt.CUSTOM,o,h,t,e||n,hn]);break;case"MultiPoint":a=t.getFlatCoordinates(),(h=this.appendFlatPointCoordinates(a,r))>o&&(this.instructions.push([mt.CUSTOM,o,h,t,n,hn]),this.hitDetectionInstructions.push([mt.CUSTOM,o,h,t,e||n,hn]));break;case"Point":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),h=this.coordinates.length,this.instructions.push([mt.CUSTOM,o,h,t,n]),this.hitDetectionInstructions.push([mt.CUSTOM,o,h,t,e||n])}this.endGeometry(i)}beginGeometry(t,e){this.beginGeometryInstruction1_=[mt.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[mt.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){var t=this.hitDetectionInstructions;let e;t.reverse();var i=t.length;let n,s,r=-1;for(e=0;e<i;++e){n=t[e],s=n[0];if(s==mt.END_GEOMETRY)r=e;else if(s==mt.BEGIN_GEOMETRY){n[2]=e;{o=void 0;a=void 0;h=void 0;l=void 0;var o=this.hitDetectionInstructions;var a=r;var h=e;for(;a<h;){var l=o[a];o[a]=o[h],o[h]=l,++a,--h}}r=-1}}}setFillStrokeStyle(t,e){var i=this.state;if(t){const e=t.getColor();i.fillStyle=S(e||m)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=S(t||De);var n=e.getLineCap(),n=(i.lineCap=void 0!==n?n:Pe,e.getLineDash()),n=(i.lineDash=n?n.slice():ke,e.getLineDashOffset()),n=(i.lineDashOffset=n||0,e.getLineJoin()),n=(i.lineJoin=void 0!==n?n:Ae,e.getWidth()),n=(i.lineWidth=void 0!==n?n:1,e.getMiterLimit());i.miterLimit=void 0!==n?n:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){var t=t.fillStyle,e=[mt.SET_FILL_STYLE,t];return"string"!=typeof t&&e.push(!0),e}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[mt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){var i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){var i=t.strokeStyle,n=t.lineCap,s=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,h=t.miterLimit;t.currentStrokeStyle==i&&t.currentLineCap==n&&(s==t.currentLineDash||gt(t.currentLineDash,s))&&t.currentLineDashOffset==r&&t.currentLineJoin==o&&t.currentLineWidth==a&&t.currentMiterLimit==h||(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;t=[mt.END_GEOMETRY,t];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){var t;return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ct(this.maxExtent),0<this.maxLineWidth)&&(t=this.resolution*(this.maxLineWidth+1)/2,yt(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)),this.bufferedMaxExtent_}},gr=class extends cr{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(e,i,n,s){const t=this.state,r=void 0!==t.fillStyle,o=void 0!==t.strokeStyle,a=n.length;this.instructions.push(lr),this.hitDetectionInstructions.push(lr);for(let t=0;t<a;++t){const r=n[t],a=this.coordinates.length,h=this.appendFlatLineCoordinates(e,i,r,s,!0,!o),l=[mt.MOVE_TO_LINE_TO,a,h];this.instructions.push(l),this.hitDetectionInstructions.push(l),o&&(this.instructions.push(dr),this.hitDetectionInstructions.push(dr)),i=r}return r&&(this.instructions.push(ar),this.hitDetectionInstructions.push(ar)),o&&(this.instructions.push(hr),this.hitDetectionInstructions.push(hr)),i}drawCircle(t,e){var i=this.state,n=i.fillStyle,s=i.strokeStyle;void 0===n&&void 0===s||(this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([mt.SET_FILL_STYLE,m]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]),n=t.getFlatCoordinates(),s=t.getStride(),t=this.coordinates.length,this.appendFlatLineCoordinates(n,0,n.length,s,!1,!1),n=[mt.CIRCLE,t],this.instructions.push(lr,n),this.hitDetectionInstructions.push(lr,n),void 0!==i.fillStyle&&(this.instructions.push(ar),this.hitDetectionInstructions.push(ar)),void 0!==i.strokeStyle&&(this.instructions.push(hr),this.hitDetectionInstructions.push(hr)),this.endGeometry(e))}drawPolygon(t,e){var i=this.state,n=i.fillStyle,s=i.strokeStyle;void 0===n&&void 0===s||(this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([mt.SET_FILL_STYLE,m]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]),n=t.getEnds(),s=t.getOrientedFlatCoordinates(),i=t.getStride(),this.drawFlatCoordinatess_(s,0,n,i),this.endGeometry(e))}drawMultiPolygon(t,e){var n=this.state,i=n.fillStyle,s=n.strokeStyle;if(void 0!==i||void 0!==s){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([mt.SET_FILL_STYLE,m]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var r=t.getEndss(),o=t.getOrientedFlatCoordinates(),a=t.getStride();let i=0;for(let t=0,e=r.length;t<e;++t)i=this.drawFlatCoordinatess_(o,i,r[t],a);this.endGeometry(e)}}finish(){this.reverseHitDetectionInstructions(),this.state=null;var i=this.tolerance;if(0!==i){var n=this.coordinates;for(let t=0,e=n.length;t<e;++t)n[t]=an(n[t],i)}return super.finish()}setFillStrokeStyles_(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};const _r={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},mr={Circle:gr,Default:cr,Image:class extends cr{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){var i,n;this.image_&&(this.beginGeometry(t,e),n=t.getFlatCoordinates(),t=t.getStride(),i=this.coordinates.length,n=this.appendFlatPointCoordinates(n,t),this.instructions.push([mt.DRAW_IMAGE,i,n,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([mt.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e))}drawMultiPoint(t,e){var i,n;this.image_&&(this.beginGeometry(t,e),n=t.getFlatCoordinates(),t=t.getStride(),i=this.coordinates.length,n=this.appendFlatPointCoordinates(n,t),this.instructions.push([mt.DRAW_IMAGE,i,n,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([mt.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e))}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){var i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class extends cr{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){var s=this.coordinates.length,t=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),e=[mt.MOVE_TO_LINE_TO,s,t];return this.instructions.push(e),this.hitDetectionInstructions.push(e),i}drawLineString(t,e){var i=this.state,n=i.strokeStyle,s=i.lineWidth;void 0!==n&&void 0!==s&&(this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,ke,0],lr),n=t.getFlatCoordinates(),s=t.getStride(),this.drawFlatCoordinates_(n,0,n.length,s),this.hitDetectionInstructions.push(hr),this.endGeometry(e))}drawMultiLineString(t,e){var n=this.state,i=n.strokeStyle,s=n.lineWidth;if(void 0!==i&&void 0!==s){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([mt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],lr);var r=t.getEnds(),o=t.getFlatCoordinates(),a=t.getStride();let i=0;for(let t=0,e=r.length;t<e;++t)i=this.drawFlatCoordinates_(o,i,r[t],a);this.hitDetectionInstructions.push(hr),this.endGeometry(e)}}finish(){var t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(hr),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(hr),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(lr)}},Polygon:gr,Text:class extends cr{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){var t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,h){const e=this.textFillState_,l=this.textStrokeState_,d=this.textState_;if(""!==this.text_&&d&&(e||l)){const c=this.coordinates;let r=c.length;var u=t.getType();let o=null,a=t.getStride();if("line"!==d.placement||"LineString"!=u&&"MultiLineString"!=u&&"Polygon"!=u&&"MultiPolygon"!=u){let n=d.overflow?null:[];switch(u){case"Point":case"MultiPoint":o=t.getFlatCoordinates();break;case"LineString":o=t.getFlatMidpoint();break;case"Circle":o=t.getCenter();break;case"MultiLineString":o=t.getFlatMidpoints(),a=2;break;case"Polygon":o=t.getFlatInteriorPoint(),d.overflow||n.push(o[2]/this.resolution),a=3;break;case"MultiPolygon":const h=t.getFlatInteriorPoints();o=[];for(let t=0,e=h.length;t<e;t+=3)d.overflow||n.push(h[t+2]/this.resolution),o.push(h[t],h[t+1]);if(0===o.length)return;a=2}const l=this.appendFlatPointCoordinates(o,a);if(l!==r){if(n&&(l-r)/2!=o.length/a){let i=r/2;n=n.filter((t,e)=>{e=c[2*(i+e)]===o[e*a]&&c[2*(i+e)+1]===o[e*a+1];return e||--i,e})}this.saveTextStates_(),(d.backgroundFill||d.backgroundStroke)&&(this.setFillStrokeStyle(d.backgroundFill,d.backgroundStroke),d.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),d.backgroundStroke)&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state))),this.beginGeometry(t,h);let s=d.padding;if(s!=ze&&(d.scale[0]<0||d.scale[1]<0)){let t=d.padding[0],e=d.padding[1],i=d.padding[2],n=d.padding[3];d.scale[0]<0&&(e=-e,n=-n),d.scale[1]<0&&(t=-t,i=-i),s=[t,e,i,n]}const g=this.pixelRatio;this.instructions.push([mt.DRAW_IMAGE,r,l,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,s==ze?ze:s.map(function(t){return t*g}),!!d.backgroundFill,!!d.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]);var i=1/g;this.hitDetectionInstructions.push([mt.DRAW_IMAGE,r,l,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[i,i],NaN,void 0,this.declutterImageWithText_,s,!!d.backgroundFill,!!d.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]),this.endGeometry(h)}}else if(_t(this.getBufferedMaxExtent(),t.getExtent())){let i;if(o=t.getFlatCoordinates(),"LineString"==u)i=[o.length];else if("MultiLineString"==u)i=t.getEnds();else if("Polygon"==u)i=t.getEnds().slice(0,1);else if("MultiPolygon"==u){const h=t.getEndss();i=[];for(let t=0,e=h.length;t<e;++t)i.push(h[t][0])}this.beginGeometry(t,h);const l=d.textAlign;let n,s=0;for(let t=0,e=i.length;t<e;++t){if(null==l){const h=function(t,e,i,n,s){let r,o,a,h,l,d,u,c,g,_=i,m=i,p=0,f=0,v=i;for(r=i;r<n;r+=s){const i=e[r],n=e[r+1];void 0!==h&&(c=i-h,g=n-l,a=Math.sqrt(c*c+g*g),void 0!==d&&(f+=o,t<Math.acos((d*c+u*g)/(o*a)))&&(f>p&&(p=f,_=v,m=r),f=0,v=r-s),o=a,d=c,u=g),h=i,l=n}return(f+=a)>p?[v,r]:[_,m]}(d.maxAngle,o,s,i[t],a);s=h[0],n=h[1]}else n=i[t];for(let t=s;t<n;t+=a)c.push(o[t],o[t+1]);const h=c.length;s=i[t],this.drawChars_(r,h),r=h}this.endGeometry(h)}}}saveTextStates_(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_,n=(!t||n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}),this.textKey_),t=(n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||Oe,justify:e.justify,textBaseline:e.textBaseline||Ge,scale:e.scale}),this.fillKey_);!i||t in this.fillStates||(this.fillStates[t]={fillStyle:i.fillStyle})}drawChars_(t,e){var i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,r=this.textKey_,o=this.fillKey_,a=(this.saveTextStates_(),this.pixelRatio),h=_r[n.textBaseline],l=this.textOffsetY_*a,d=this.text_,i=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([mt.DRAW_CHARS,t,e,h,n.overflow,o,n.maxAngle,a,l,s,i*a,d,r,1]),this.hitDetectionInstructions.push([mt.DRAW_CHARS,t,e,h,n.overflow,o,n.maxAngle,1,l,s,i,d,r,1/a])}setTextStyle(t,e){let i,n,s;if(t){const e=t.getFill();e?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=S(e.getColor()||m)):(n=null,this.textFillState_=n);var r=t.getStroke();if(r){(s=this.textStrokeState_)||(s={},this.textStrokeState_=s);const t=r.getLineDash(),e=r.getLineDashOffset(),i=r.getWidth(),n=r.getMiterLimit();s.lineCap=r.getLineCap()||Pe,s.lineDash=t?t.slice():ke,s.lineDashOffset=void 0===e?0:e,s.lineJoin=r.getLineJoin()||Ae,s.lineWidth=void 0===i?1:i,s.miterLimit=void 0===n?10:n,s.strokeStyle=S(r.getColor()||De)}else s=null,this.textStrokeState_=s;i=this.textState_;var r=t.getFont()||Le,o=(Ye(r),t.getScaleArray()),r=(i.overflow=t.getOverflow(),i.font=r,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Ge,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ze,i.scale=void 0===o?[1,1]:o,t.getOffsetX()),o=t.getOffsetY(),a=t.getRotateWithView(),h=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===r?0:r,this.textOffsetY_=void 0===o?0:o,this.textRotateWithView_=void 0!==a&&a,this.textRotation_=void 0===h?0:h,this.strokeKey_=s?("string"==typeof s.strokeStyle?s.strokeStyle:z(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+z(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}},pr=class{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){var t={};for(const n in this.buildersByZIndex_){t[n]=t[n]||{};var e=this.buildersByZIndex_[n];for(const s in e){var i=e[s].finish();t[n][s]=i}}return t}getBuilder(t,e){t=void 0!==t?t.toString():"0";let i=this.buildersByZIndex_[t],n=(void 0===i&&(i={},this.buildersByZIndex_[t]=i),i[e]);return void 0===n&&(n=new mr[e](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[e]=n),n}};const fr=[1/0,1/0,-1/0,-1/0],vr=[],T=[],R=[],xr=[];function yr(t){return t[3].declutterBox}const Cr=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Sr(t,e){return"start"!==e&&"end"!==e||Cr.test(t)||(e="start"===e?"left":"right"),_r[e]}function wr(t,e,i){return 0<i&&t.push("\n",""),t.push(e,""),t}const Er=class{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,i,n,s){const r=t+i+n+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,e=n?this.fillStates[n]:null,a=this.textStates[i],h=this.pixelRatio,l=[a.scale[0]*h,a.scale[1]*h],d=Array.isArray(t),u=a.justify?_r[a.justify]:Sr(Array.isArray(t)?t[0]:t,a.textAlign||Oe),c=s&&o.lineWidth?o.lineWidth:0,g=d?t:t.split("\n").reduce(wr,[]),{width:_,height:m,widths:p,heights:f,lineWidths:v}=function(i,n){var s=[],r=[],o=[];let a=0,h=0,l=0,d=0;for(let t=0,e=n.length;t<=e;t+=2){var u,c=n[t];"\n"===c||t===e?(a=Math.max(a,h),o.push(h),h=0,l+=d):(c=Ze(u=n[t+1]||i.font,c),c=(s.push(c),h+=c,Be(u)),r.push(c),d=Math.max(d,c))}return{width:a,height:l,widths:s,heights:r,lineWidths:o}}(a,g),x=_+c,y=[],C=(x+2)*l[0],S=(m+c)*l[1],w={width:C<0?Math.floor(C):Math.ceil(C),height:S<0?Math.floor(S):Math.ceil(S),contextInstructions:y};1==l[0]&&1==l[1]||y.push("scale",l),s&&(y.push("strokeStyle",o.strokeStyle),y.push("lineWidth",c),y.push("lineCap",o.lineCap),y.push("lineJoin",o.lineJoin),y.push("miterLimit",o.miterLimit),y.push("setLineDash",[o.lineDash]),y.push("lineDashOffset",o.lineDashOffset)),n&&y.push("fillStyle",e.fillStyle),y.push("textBaseline","middle"),y.push("textAlign","center");var E=.5-u;let T=u*x+E*c;var R=[],I=[];let b,M=0,F=0,L=0,P=0;for(let t=0,e=g.length;t<e;t+=2){const i=g[t];if("\n"===i)F+=M,M=0,T=u*x+E*c,++P;else{const r=g[t+1]||a.font,o=(r!==b&&(s&&R.push("font",r),n&&I.push("font",r),b=r),M=Math.max(M,f[L]),[i,T+E*p[L]+u*(p[L]-v[P]),.5*(c+M)+F]);T+=p[L],s&&R.push("strokeText",o),n&&I.push("fillText",o),++L}}return Array.prototype.push.apply(y,R),Array.prototype.push.apply(y,I),this.labels_[r]=w}replayTextBackground_(t,e,i,n,s,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),r&&(this.alignFill_=r[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,r,o,a,h,l,d,u,c,g,_,m){let p=i-(o*=u[0]),f=n-(a*=u[1]);o=t<s+h?t-h:s,a=e<r+l?e-l:r,t=g[3]+o*u[0]+g[1],s=g[0]+a*u[1]+g[2],e=p-g[3],r=f-g[0];let v;return!_&&0===d||(vr[0]=e,xr[0]=e,vr[1]=r,T[1]=r,T[0]=e+t,R[0]=T[0],R[1]=r+s,xr[1]=R[1]),0!==d?(W(v=X([1,0,0,1,0,0],i,n,1,1,d,-i,-n),vr),W(v,T),W(v,R),W(v,xr),x(Math.min(vr[0],T[0],R[0],xr[0]),Math.min(vr[1],T[1],R[1],xr[1]),Math.max(vr[0],T[0],R[0],xr[0]),Math.max(vr[1],T[1],R[1],xr[1]),fr)):x(Math.min(e,e+t),Math.min(r,r+s),Math.max(e,e+t),Math.max(r,r+s),fr),c&&(p=Math.round(p),f=Math.round(f)),{drawImageX:p,drawImageY:f,drawImageW:o,drawImageH:a,originX:h,originY:l,declutterBox:{minX:fr[0],minY:fr[1],maxX:fr[2],maxY:fr[3],value:m},canvasTransform:v,scale:u}}replayImageOrLabel_(t,e,i,n,s,r,o){var a=!(!r&&!o),h=n.declutterBox,l=t.canvas,d=o?o[2]*n.scale[0]/2:0;if(h.minX-d<=l.width/e&&0<=h.maxX+d&&h.minY-d<=l.height/e&&0<=h.maxY+d){if(a&&this.replayTextBackground_(t,vr,T,R,xr,r,o),l=t,e=n.canvasTransform,h=s,d=i,a=n.originX,r=n.originY,o=n.drawImageW,t=n.drawImageH,s=n.drawImageX,i=n.drawImageY,n=n.scale,l.save(),1!==h&&(l.globalAlpha*=h),e&&l.setTransform.apply(l,e),d.contextInstructions){l.translate(s,i),l.scale(n[0],n[1]);var u=l,c=d.contextInstructions;for(let t=0,e=c.length;t<e;t+=2)Array.isArray(c[t+1])?u[c[t]].apply(u,c[t+1]):u[c[t]]=c[t+1]}else n[0]<0||n[1]<0?(l.translate(s,i),l.scale(n[0],n[1]),l.drawImage(d,a,r,o,t,0,0,o,t)):l.drawImage(d,a,r,o,t,s,i,o*n[0],t*n[1]);l.restore()}return!0}fill_(t){var e,i;this.alignFill_&&(e=W(this.renderedTransform_,[0,0]),i=512*this.pixelRatio,t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)),t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){var s=this.textStates[e],e=this.createLabel(t,e,n,i),n=this.strokeStates[i],i=this.pixelRatio,t=Sr(Array.isArray(t)?t[0]:t,s.textAlign||Oe),r=_r[s.textBaseline||Ge],n=n&&n.lineWidth?n.lineWidth:0;return{label:e,anchorX:t*(e.width/i-2*s.scale[0])+2*(.5-t)*n,anchorY:r*e.height/i+2*(.5-r)*n}}execute_(l,d,u,c,Z,g,K,_){let m;var p,f;this.pixelCoordinates_&&gt(u,this.renderedTransform_)?m=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),m=Ji(this.coordinates,0,this.coordinates.length,2,u,this.pixelCoordinates_),(p=this.renderedTransform_)[0]=(f=u)[0],p[1]=f[1],p[2]=f[2],p[3]=f[3],p[4]=f[4],p[5]=f[5]);let v=0;const x=c.length;let y,C,S,w,E,T,R,I,b,M,F,L,P=0,k=0,A=0,V=null,U=null;var q=this.coordinateCache_,H=this.viewRotation_,J=Math.round(1e12*Math.atan2(-u[1],u[0]))/1e12,Q={context:l,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:H},D=this.instructions!=c||this.overlaps?0:200;let O,G,z,$;for(;v<x;){const u=c[v];switch(u[0]){case mt.BEGIN_GEOMETRY:O=u[1],$=u[3],O.getGeometry()?void 0===K||_t(K,$.getExtent())?++v:v=u[2]+1:v=u[2];break;case mt.BEGIN_PATH:k>D&&(this.fill_(l),k=0),A>D&&(l.stroke(),A=0),k||A||(l.beginPath(),w=NaN,E=NaN),++v;break;case mt.CIRCLE:P=u[1];const c=m[P],gt=m[P+1],p=m[P+2]-c,f=m[P+3]-gt,x=Math.sqrt(p*p+f*f);l.moveTo(c+x,gt),l.arc(c,gt,x,0,2*Math.PI,!0),++v;break;case mt.CLOSE_PATH:l.closePath(),++v;break;case mt.CUSTOM:P=u[1],y=u[2];var W=u[3],tt=u[4],et=6==u.length?u[5]:void 0,W=(Q.geometry=W,Q.feature=O,v in q||(q[v]=[]),q[v]);et?et(m,P,y,2,W):(W[0]=m[P],W[1]=m[P+1],W.length=2),tt(W,Q),++v;break;case mt.DRAW_IMAGE:P=u[1],y=u[2],I=u[3],C=u[4],S=u[5];let t=u[6];var it=u[7],nt=u[8],st=u[9],et=u[10];let e=u[11];var rt=u[12];let i=u[13];var ot=u[14],X=u[15];if(!I&&20<=u.length){b=u[19],M=u[20],F=u[21],L=u[22];const l=this.drawLabelWithPointPlacement_(b,M,F,L),d=(I=l.label,u[3]=I,u[23]),c=(C=(l.anchorX-d)*this.pixelRatio,u[4]=C,u[24]);S=(l.anchorY-c)*this.pixelRatio,u[5]=S,t=I.height,u[6]=t,i=I.width,u[13]=i}let n,s,r,o,a=(25<u.length&&(n=u[25]),o=17<u.length?(s=u[16],r=u[17],u[18]):(s=ze,r=!1),et&&J?e+=H:et||J||(e-=H),0);for(;P<y;P+=2)if(!(n&&n[a++]<i/this.pixelRatio)){const u=this.calculateImageOrLabelDimensions_(I.width,I.height,m[P],m[P+1],i,t,C,S,nt,st,e,rt,Z,s,r||o,O),c=[l,d,I,u,it,r?V:null,o?U:null];if(_){if("none"===ot)continue;if("obstacle"===ot){_.insert(u.declutterBox);continue}{let t,e;if(X){const u=y-P;if(!X[u]){X[u]=c;continue}if(t=X[u],delete X[u],e=yr(t),_.collides(e))continue}if(_.collides(u.declutterBox))continue;t&&(_.insert(e),this.replayImageOrLabel_.apply(this,t)),_.insert(u.declutterBox)}}this.replayImageOrLabel_.apply(this,c)}++v;break;case mt.DRAW_CHARS:var tt=u[1],W=u[2],at=u[3],ht=u[4],lt=(L=u[5],u[6]),N=u[7],dt=u[8],ut=(F=u[9],u[10]),ct=(b=u[11],M=u[12],[u[13],u[13]]),Y=this.textStates[M],B=Y.font,j=[Y.scale[0]*N,Y.scale[1]*N];let h;B in this.widths_?h=this.widths_[B]:(h={},this.widths_[B]=h);Y=function(e,i,n,s){let r=e[i],o=e[i+1],a=0;for(let t=i+s;t<n;t+=s){const i=e[t],n=e[t+1];a+=Math.sqrt((i-r)*(i-r)+(n-o)*(n-o)),r=i,o=n}return a}(m,tt,W,2),N=Math.abs(j[0])*Ke(B,b,h);if(ht||N<=Y){const u=this.textStates[M].textAlign,c=function(t,s,r,o,a,h,l,d,u,c,g,e){let _=t[s],m=t[s+1],p=0,f=0,v=0,x=0;function y(){p=_,f=m,_=t[s+=o],m=t[s+1],x+=v,v=Math.sqrt((_-p)*(_-p)+(m-f)*(m-f))}for(;y(),s<r-o&&x+v<h;);var C=0===v?0:(h-x)/v;const i=Kt(p,_,C),S=Kt(f,m,C),n=s-o,w=x,E=h+d*u(c,a,g);for(;s<r-o&&x+v<E;)y();C=0===v?0:(E-x)/v;const T=Kt(p,_,C),R=Kt(f,m,C);let I;if(e){const t=[i,S,T,R];Qi(t,0,4,2,e,t,t),I=t[0]>t[2]}else I=i>T;var b=Math.PI,M=[],e=n+o===s;let F;if(v=0,x=w,_=t[s=n],m=t[s+1],e){y(),F=Math.atan2(m-f,_-p),I&&(F+=0<F?-b:b);const t=(T+i)/2,s=(R+S)/2;M[0]=[t,s,(E-h)/2,F,a]}else for(let i=0,n=(a=a.replace(/\n/g," ")).length;i<n;){y();let t=Math.atan2(m-f,_-p);if(I&&(t+=0<t?-b:b),void 0!==F){var L=t-F;if(L+=b<L?-2*b:L<-b?2*b:0,Math.abs(L)>l)return null}F=t;const S=i;let e=0;for(;i<n;++i){const l=d*u(c,a[I?n-i-1:i],g);if(s+o<r&&x+v<h+e+l/2)break;e+=l}if(i!==S){const w=I?a.substring(n-S,n-i):a.substring(S,i),E=(C=0===v?0:(h+e/2-x)/v,Kt(p,_,C)),T=Kt(f,m,C);M.push([E,T,e/2,t,w]),h+=e}}return M}(m,tt,W,2,b,(Y-N)*_r[u],lt,Math.abs(j[0]),Ke,B,h,J?0:this.viewRotation_);t:if(c){const u=[];let t,e,i,n,s;if(F)for(t=0,e=c.length;t<e;++t){s=c[t],i=s[4],n=this.createLabel(i,M,"",F),C=s[2]+(j[0]<0?-ut:ut),S=at*n.height+2*(.5-at)*ut*j[1]/j[0]-dt;const g=this.calculateImageOrLabelDimensions_(n.width,n.height,s[0],s[1],n.width,n.height,C,S,0,0,s[3],ct,!1,ze,!1,O);if(_&&_.collides(g.declutterBox))break t;u.push([l,d,n,g,1,null,null])}if(L)for(t=0,e=c.length;t<e;++t){s=c[t],i=s[4],n=this.createLabel(i,M,L,""),C=s[2],S=at*n.height-dt;const g=this.calculateImageOrLabelDimensions_(n.width,n.height,s[0],s[1],n.width,n.height,C,S,0,0,s[3],ct,!1,ze,!1,O);if(_&&_.collides(g.declutterBox))break t;u.push([l,d,n,g,1,null,null])}_&&_.load(u.map(yr));for(let t=0,e=u.length;t<e;++t)this.replayImageOrLabel_.apply(this,u[t])}}++v;break;case mt.END_GEOMETRY:if(void 0!==g){const l=g(O=u[1],$);if(l)return l}++v;break;case mt.FILL:D?k++:this.fill_(l),++v;break;case mt.MOVE_TO_LINE_TO:for(P=u[1],y=u[2],G=m[P],z=m[P+1],T=G+.5|0,R=z+.5|0,T===w&&R===E||(l.moveTo(G,z),w=T,E=R),P+=2;P<y;P+=2)G=m[P],z=m[P+1],T=G+.5|0,R=z+.5|0,P!=y-2&&T===w&&R===E||(l.lineTo(G,z),w=T,E=R);++v;break;case mt.SET_FILL_STYLE:V=u,this.alignFill_=u[2],k&&(this.fill_(l),k=0,A)&&(l.stroke(),A=0),l.fillStyle=u[1],++v;break;case mt.SET_STROKE_STYLE:U=u,A&&(l.stroke(),A=0),this.setStrokeStyle_(l,u),++v;break;case mt.STROKE:D?A++:l.stroke(),++v;break;default:++v}}k&&this.fill_(l),A&&l.stroke()}execute(t,e,i,n,s,r){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,r)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,s)}},Tr=["Polygon","Circle","LineString","Image","Text","Default"],Rr={},Ir=class{constructor(t,e,i,n,s,r){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(s)}clip(t,e){e=this.getClipCoords(e);t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[4],e[5]),t.lineTo(e[6],e[7]),t.clip()}createExecutors_(e){for(const s in e){let t=this.executorsByZIndex_[s];void 0===t&&(t={},this.executorsByZIndex_[s]=t);var i=e[s];for(const e in i){var n=i[e];t[e]=new Er(this.resolution_,this.pixelRatio_,this.overlaps_,n)}}}hasExecutors(i){for(const t in this.executorsByZIndex_){var n=this.executorsByZIndex_[t];for(let t=0,e=i.length;t<e;++t)if(i[t]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,a,h,l){const d=2*(a=Math.round(a))+1,n=X(this.hitDetectionTransform_,a+.5,a+.5,1/e,-1/e,-i,-t[0],-t[1]),s=!this.hitDetectionContext_,u=(s&&(this.hitDetectionContext_=w(d,d)),this.hitDetectionContext_);let r;u.canvas.width!==d||u.canvas.height!==d?(u.canvas.width=d,u.canvas.height=d):s||u.clearRect(0,0,d,d),void 0!==this.renderBuffer_&&(Mt(r=[1/0,1/0,-1/0,-1/0],t),yt(r,e*(this.renderBuffer_+a),r));const c=function(n){if(void 0!==Rr[n])return Rr[n];var s=2*n+1,r=n*n,o=new Array(1+r);for(let i=0;i<=n;++i)for(let e=0;e<=n;++e){var a=i*i+e*e;if(r<a)break;let t=o[a];t||(t=[],o[a]=t),t.push(4*((n+i)*s+(n+e))+3),0<i&&t.push(4*((n-i)*s+(n+e))+3),0<e&&(t.push(4*((n+i)*s+(n-e))+3),0<i)&&t.push(4*((n-i)*s+(n-e))+3)}var i=[];for(let t=0,e=o.length;t<e;++t)o[t]&&i.push(...o[t]);return Rr[n]=i}(a);let g;function o(i,n){const s=u.getImageData(0,0,d,d).data;for(let t=0,e=c.length;t<e;t++)if(0<s[c[t]]){if(!l||"Image"!==g&&"Text"!==g||l.includes(i)){const s=(c[t]-3)/4,l=a-s%d,r=a-(s/d|0),o=h(i,n,l*l+r*r);if(o)return o}u.clearRect(0,0,d,d);break}}var _=Object.keys(this.executorsByZIndex_).map(Number);let m,p,f,v,x;for(_.sort(G),m=_.length-1;0<=m;--m){const t=_[m].toString();for(f=this.executorsByZIndex_[t],p=Tr.length-1;0<=p;--p)if(g=Tr[p],void 0!==(v=f[g])&&(x=v.executeHitDetection(u,n,i,o,r)))return x}}getClipCoords(t){var e,i,n,s=this.maxExtent_;return s?(n=s[0],e=s[1],i=s[2],Ji(s=[n,e,n,n=s[3],i,n,i,e],0,8,2,t,s),s):null}isEmpty(){return D(this.executorsByZIndex_)}execute(t,e,i,n,s,r,o){var a=Object.keys(this.executorsByZIndex_).map(Number);let h,l,d,u,c,g;for(a.sort(G),this.maxExtent_&&(t.save(),this.clip(t,i)),r=r||Tr,o&&a.reverse(),h=0,l=a.length;h<l;++h){const G=a[h].toString();for(c=this.executorsByZIndex_[G],d=0,u=r.length;d<u;++d)void 0!==(g=c[r[d]])&&g.execute(t,e,i,n,s,o)}this.maxExtent_&&t.restore()}},br=class extends ur{constructor(t,e,i,n,s,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=s,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(n,s,r,o){if(this.image_){var a=Ji(n,s,r,o,this.transform_,this.pixelCoordinates_),h=this.context_,l=this.tmpLocalTransform_,n=h.globalAlpha;1!=this.imageOpacity_&&(h.globalAlpha=n*this.imageOpacity_);let i=this.imageRotation_;this.imageRotateWithView_&&(i+=this.viewRotation_);for(let t=0,e=a.length;t<e;t+=2){const s=a[t]-this.imageAnchorX_,r=a[t+1]-this.imageAnchorY_;if(0!==i||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const n=s+this.imageAnchorX_,o=r+this.imageAnchorY_;X(l,n,o,1,1,i,-n,-o),h.setTransform.apply(h,l),h.translate(n,o),h.scale(this.imageScale_[0],this.imageScale_[1]),h.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),h.setTransform(1,0,0,1,0,0)}else h.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,s,r,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(h.globalAlpha=n)}}drawText_(e,i,n,s){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var r=Ji(e,i,n,s,this.transform_,this.pixelCoordinates_),o=this.context_;let t=this.textRotation_;for(this.textRotateWithView_&&(t+=this.viewRotation_);i<n;i+=s){const e=r[i]+this.textOffsetX_,n=r[i+1]+this.textOffsetY_;0!==t||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.translate(e-this.textOffsetX_,n-this.textOffsetY_),o.rotate(t),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,e,n),this.textFillState_&&o.fillText(this.text_,e,n))}}}moveToLineTo_(t,e,i,n,s){var r=this.context_,o=Ji(t,e,i,n,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;s&&(a-=2);for(let t=2;t<a;t+=2)r.lineTo(o[t],o[t+1]);return s&&r.closePath(),i}drawRings_(i,n,s,r){for(let t=0,e=s.length;t<e;++t)n=this.moveToLineTo_(i,n,s[t],r,!0);return n}drawCircle(t){var e,i,n,s;_t(this.extent_,t.getExtent())&&((this.fillState_||this.strokeState_)&&(this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_),e=t,i=this.transform_,n=this.pixelCoordinates_,e=(s=(s=e.getFlatCoordinates())?(e=e.getStride(),Ji(s,0,s.length,e,i,n)):null)[2]-s[0],i=s[3]-s[1],n=Math.sqrt(e*e+i*i),(e=this.context_).beginPath(),e.arc(s[0],s[1],n,0,2*Math.PI),this.fillState_&&e.fill(),this.strokeState_)&&e.stroke(),""!==this.text_)&&this.drawText_(t.getCenter(),0,2,2)}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}}drawFeature(t,e){t=e.getGeometryFunction()(t);t&&_t(this.extent_,t.getExtent())&&(this.setStyle(e),this.drawGeometry(t))}drawGeometryCollection(t){var i=t.getGeometriesArray();for(let t=0,e=i.length;t<e;++t)this.drawGeometry(i[t])}drawPoint(t){var e=(t=this.squaredTolerance_?t.simplifyTransformed(this.squaredTolerance_,this.userTransform_):t).getFlatCoordinates(),t=t.getStride();this.image_&&this.drawImages_(e,0,e.length,t),""!==this.text_&&this.drawText_(e,0,e.length,t)}drawMultiPoint(t){var e=(t=this.squaredTolerance_?t.simplifyTransformed(this.squaredTolerance_,this.userTransform_):t).getFlatCoordinates(),t=t.getStride();this.image_&&this.drawImages_(e,0,e.length,t),""!==this.text_&&this.drawText_(e,0,e.length,t)}drawLineString(t){var e,i;this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),_t(this.extent_,t.getExtent())&&(this.strokeState_&&(this.setContextStrokeState_(this.strokeState_),e=this.context_,i=t.getFlatCoordinates(),e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()),""!==this.text_)&&(i=t.getFlatMidpoint(),this.drawText_(i,0,2,2))}drawMultiLineString(t){const e=(t=this.squaredTolerance_?t.simplifyTransformed(this.squaredTolerance_,this.userTransform_):t).getExtent();if(_t(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,r=t.getFlatCoordinates();let i=0;var n=t.getEnds(),s=t.getStride();e.beginPath();for(let t=0,e=n.length;t<e;++t)i=this.moveToLineTo_(r,i,n[t],s,!1);e.stroke()}if(""!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){var e;this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),_t(this.extent_,t.getExtent())&&((this.strokeState_||this.fillState_)&&(this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_),(e=this.context_).beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_)&&e.stroke(),""!==this.text_)&&(e=t.getFlatInteriorPoint(),this.drawText_(e,0,2,2))}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),_t(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getOrientedFlatCoordinates();let i=0;var s=t.getEndss(),r=t.getStride();e.beginPath();for(let t=0,e=s.length;t<e;++t){var o=s[t];i=this.drawRings_(n,i,o,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}""!==this.text_&&(e=t.getFlatInteriorPoints(),this.drawText_(e,0,e.length,2))}}setContextFillState_(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),gt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){var e=this.context_,i=this.contextTextState_,n=t.textAlign||Oe;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:S(e||m)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),n=e.getLineDash(),s=e.getLineDashOffset(),r=e.getLineJoin(),o=e.getWidth(),a=e.getMiterLimit(),h=n||ke;this.strokeState_={lineCap:void 0!==i?i:Pe,lineDash:1===this.pixelRatio_?h:h.map(t=>t*this.pixelRatio_),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:void 0!==r?r:Ae,lineWidth:(void 0!==o?o:1)*this.pixelRatio_,miterLimit:void 0!==a?a:10,strokeStyle:S(t||De)}}else this.strokeState_=null}setImageStyle(t){let e;var i,n,s;t&&(e=t.getSize())?(i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),n=t.getOrigin(),this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),s=t.getScaleArray(),this.imageScale_=[s[0]*this.pixelRatio_/i,s[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i):this.image_=null}setTextStyle(t){if(t){var e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:S(t||m)}}else this.textFillState_=null;e=t.getStroke();if(e){const t=e.getColor(),l=e.getLineCap(),d=e.getLineDash(),u=e.getLineDashOffset(),c=e.getLineJoin(),g=e.getWidth(),_=e.getMiterLimit();this.textStrokeState_={lineCap:void 0!==l?l:Pe,lineDash:d||ke,lineDashOffset:u||0,lineJoin:void 0!==c?c:Ae,lineWidth:void 0!==g?g:1,miterLimit:void 0!==_?_:10,strokeStyle:S(t||De)}}else this.textStrokeState_=null;var e=t.getFont(),i=t.getOffsetX(),n=t.getOffsetY(),s=t.getRotateWithView(),r=t.getRotation(),o=t.getScaleArray(),a=t.getText(),h=t.getTextAlign(),t=t.getTextBaseline();this.textState_={font:void 0!==e?e:Le,textAlign:void 0!==h?h:Oe,textBaseline:void 0!==t?t:Ge},this.text_=void 0!==a?Array.isArray(a)?a.reduce((t,e,i)=>t+(i%2?" ":e),""):a:"",this.textOffsetX_=void 0!==i?this.pixelRatio_*i:0,this.textOffsetY_=void 0!==n?this.pixelRatio_*n:0,this.textRotateWithView_=void 0!==s&&s,this.textRotation_=void 0!==r?r:0,this.textScale_=[this.pixelRatio_*o[0],this.pixelRatio_*o[1]]}else this.text_=""}},Mr={Point:function(e,i,n,s,r){var o=n.getImage(),a=n.getText();let h;if(o){if(2!=o.getImageState())return;let t=e;if(r){var l=o.getDeclutterMode();if("none"!==l)if(t=r,"obstacle"===l){const r=e.getBuilder(n.getZIndex(),"Image");r.setImageStyle(o,h),r.drawPoint(i,s)}else a&&a.getText()&&(h={})}l=t.getBuilder(n.getZIndex(),"Image");l.setImageStyle(o,h),l.drawPoint(i,s)}if(a&&a.getText()){let t=e;o=(t=r?r:t).getBuilder(n.getZIndex(),"Text");o.setTextStyle(a,h),o.drawText(i,s)}},LineString:function(t,e,i,n,s){const r=i.getStroke();if(r){const s=t.getBuilder(i.getZIndex(),"LineString");s.setFillStrokeStyle(null,r),s.drawLineString(e,n)}var o=i.getText();if(o&&o.getText()){const r=(s||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(o),r.drawText(e,n)}},Polygon:function(t,e,i,n,s){const r=i.getFill(),o=i.getStroke();if(r||o){const s=t.getBuilder(i.getZIndex(),"Polygon");s.setFillStrokeStyle(r,o),s.drawPolygon(e,n)}var a=i.getText();if(a&&a.getText()){const r=(s||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,n)}},MultiPoint:function(e,i,n,s,r){var o=n.getImage(),a=n.getText();let h;if(o){if(2!=o.getImageState())return;let t=e;if(r){var l=o.getDeclutterMode();if("none"!==l)if(t=r,"obstacle"===l){const r=e.getBuilder(n.getZIndex(),"Image");r.setImageStyle(o,h),r.drawMultiPoint(i,s)}else a&&a.getText()&&(h={})}l=t.getBuilder(n.getZIndex(),"Image");l.setImageStyle(o,h),l.drawMultiPoint(i,s)}if(a&&a.getText()){let t=e;o=(t=r?r:t).getBuilder(n.getZIndex(),"Text");o.setTextStyle(a,h),o.drawText(i,s)}},MultiLineString:function(t,e,i,n,s){const r=i.getStroke();if(r){const s=t.getBuilder(i.getZIndex(),"LineString");s.setFillStrokeStyle(null,r),s.drawMultiLineString(e,n)}var o=i.getText();if(o&&o.getText()){const r=(s||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(o),r.drawText(e,n)}},MultiPolygon:function(t,e,i,n,s){const r=i.getFill(),o=i.getStroke();if(o||r){const s=t.getBuilder(i.getZIndex(),"Polygon");s.setFillStrokeStyle(r,o),s.drawMultiPolygon(e,n)}var a=i.getText();if(a&&a.getText()){const r=(s||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,n)}},GeometryCollection:function(t,e,i,n,s){var r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o)(0,Mr[r[o].getType()])(t,r[o],i,n,s)},Circle:function(t,e,i,n,s){const r=i.getFill(),o=i.getStroke();if(r||o){const s=t.getBuilder(i.getZIndex(),"Circle");s.setFillStrokeStyle(r,o),s.drawCircle(e,n)}var a=i.getText();if(a&&a.getText()){const r=(s||t).getBuilder(i.getZIndex(),"Text");r.setTextStyle(a),r.drawText(e,n)}}};function Fr(t,e){return parseInt(z(t),10)-parseInt(z(e),10)}function Lr(t,e,i,n,s,r,o){let a=!1;var h=i.getImage();if(h){const t=h.getImageState();2==t||3==t?h.unlistenImageChange(s):(0==t&&h.load(),h.listenImageChange(s),a=!0)}return h=t,s=e,t=n,e=r,n=o,(o=(r=i).getGeometryFunction()(s))&&(o=o.simplifyTransformed(t,e),r.getRenderer()?function i(n,t,s,r){if("GeometryCollection"!=t.getType())n.getBuilder(s.getZIndex(),"Default").drawCustom(t,r,s.getRenderer(),s.getHitDetectionRenderer());else{const o=t.getGeometries();for(let t=0,e=o.length;t<e;++t)i(n,o[t],s,r)}}(h,o,r,s):(0,Mr[o.getType()])(h,o,r,s,n)),a}const Pr=class extends Gs{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){var n=e.extent,s=e.viewState,r=s.center,o=s.resolution,a=s.projection,h=s.rotation,s=a.getExtent(),l=this.getLayer().getSource(),d=e.pixelRatio,u=e.viewHints,c=!(u[0]||u[1]),g=this.compositionContext_,_=Math.round(e.size[0]*d),m=Math.round(e.size[1]*d),u=l.getWrapX()&&a.canWrapX(),p=u?Y(s):null,f=u?Math.ceil((n[2]-s[2])/p)+1:1;let v=u?Math.floor((n[0]-s[0])/p):0;do{const e=this.getRenderTransform(r,o,h,d,_,m,v*p);t.execute(g,1,e,h,c,void 0,i)}while(++v<f)}setupCompositionContext_(){var t;1!==this.opacity_?(t=w(this.context.canvas.width,this.context.canvas.height,Ds),this.compositionContext_=t):this.compositionContext_=this.context}releaseCompositionContext_(){var t;1!==this.opacity_&&(t=this.context.globalAlpha,this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,be(this.compositionContext_),Ds.push(this.compositionContext_.canvas),this.compositionContext_=null)}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){var i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex],s=(o=this.pixelTransform,r=s=1/i,(o=o)[0]=s,o[1]=0,o[2]=0,o[3]=r,o[4]=0,o[5]=0,pt(this.inversePixelTransform,this.pixelTransform),vt(this.pixelTransform)),r=(this.useContainer(e,s,this.getBackground(t)),this.context),o=r.canvas,e=this.replayGroup_,a=this.declutterExecutorGroup;if((!e||e.isEmpty())&&(!a||a.isEmpty()))return null;a=Math.round(t.size[0]*i),i=Math.round(t.size[1]*i),o.width!=a||o.height!=i?(o.width=a,o.height=i,o.style.transform!==s&&(o.style.transform=s)):this.containerReused||r.clearRect(0,0,a,i),this.preRender(r,t),o=t.viewState;o.projection,this.opacity_=n.opacity,this.setupCompositionContext_();let h=!1,l=!0;if(n.extent&&this.clipping){const e=n.extent;l=_t(e,t.extent),(h=l&&!Et(e,t.extent))&&this.clipUnrotated(this.compositionContext_,t,e)}return l&&this.renderWorlds(e,t),h&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(r,t),this.renderedRotation_!==o.rotation&&(this.renderedRotation_=o.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(m){return new Promise(function(n){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const m=[this.context.canvas.width,this.context.canvas.height],n=(W(this.pixelTransform,m),this.renderedCenter_),a=this.renderedResolution_,h=this.renderedRotation_,l=this.renderedProjection_,d=this.wrappedRenderedExtent_,u=this.getLayer(),c=[],g=.5*m[0],_=.5*m[1];c.push(this.getRenderTransform(n,a,h,.5,g,_,0).slice());var t=u.getSource(),s=l.getExtent();if(t.getWrapX()&&l.canWrapX()&&!Et(s,d)){let t=d[0];const G=Y(s);let e,i=0;for(;t<s[0];)--i,e=G*i,c.push(this.getRenderTransform(n,a,h,.5,g,_,e).slice()),t+=G;for(i=0,t=d[2];t>s[2];)++i,e=G*i,c.push(this.getRenderTransform(n,a,h,.5,g,_,e).slice()),t-=G}this.hitDetectionImageData_=function(n,s,r,o,a,h,t){const l=w(.5*n[0],.5*n[1]),d=(l.imageSmoothingEnabled=!1,l.canvas),u=new br(l,.5,a,null,t),c=r.length,e=Math.floor(16777215/c),g={};for(let t=1;t<=c;++t){const s=r[t-1],G=s.getStyleFunction()||o;if(o){let i=G(s,h);if(i){Array.isArray(i)||(i=[i]);const l="#"+("000000"+(t*e).toString(16)).slice(-6);for(let t=0,e=i.length;t<e;++t){const r=i[t],o=r.getGeometryFunction()(s);if(o&&_t(a,o.getExtent())){const G=r.clone(),h=G.getFill(),d=(h&&h.setColor(l),G.getStroke()),u=(d&&(d.setColor(l),d.setLineDash(null)),G.setText(void 0),r.getImage());if(u&&0!==u.getOpacity()){const n=u.getImageSize();if(!n)continue;const s=w(n[0],n[1],void 0,{alpha:!1}),r=s.canvas;s.fillStyle=l,s.fillRect(0,0,r.width,r.height),G.setImage(new $s({img:r,imgSize:n,anchor:u.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:u.getOrigin(),opacity:1,size:u.getSize(),scale:u.getScale(),rotation:u.getRotation(),rotateWithView:u.getRotateWithView()}))}const c=G.getZIndex()||0;let t=g[c];t||(t={},(g[c]=t).Polygon=[],t.Circle=[],t.LineString=[],t.Point=[]),t[o.getType().replace("Multi","")].push(o,G)}}}}}var i=Object.keys(g).map(Number).sort(G);for(let t=0,e=i.length;t<e;++t){const r=g[i[t]];for(const n in r){const o=r[n];for(let i=0,t=o.length;i<t;i+=2){u.setStyle(o[i+1]);for(let t=0,e=s.length;t<e;++t)u.setTransform(s[t]),u.drawGeometry(o[i])}}}return l.getImageData(0,0,d.width,d.height)}(m,c,this.renderedFeatures_,u.getStyleFunction(),d,a,h)}var e,i,r,o;n((t=m,n=this.renderedFeatures_,e=this.hitDetectionImageData_,o=[],e&&(r=Math.floor(.5*Math.round(t[0])),t=Math.floor(.5*Math.round(t[1])),r=4*(E(r,0,e.width-1)+E(t,0,e.height-1)*e.width),t=e.data[r],i=e.data[1+r],e=e.data[2+r]+256*(i+256*t),r=Math.floor(16777215/n.length),e)&&e%r==0&&o.push(n[e/r-1]),o))}.bind(this))}forEachFeatureAtCoordinate(i,n,s,r,o){if(this.replayGroup_){const a=n.viewState.resolution,h=n.viewState.rotation,l=this.getLayer(),d={},u=function(t,e,i){var n=z(t),s=d[n];if(s){if(!0!==s&&i<s.distanceSq){if(0===i)return d[n]=!0,o.splice(o.lastIndexOf(s),1),r(t,l,e);s.geometry=e,s.distanceSq=i}}else{if(0===i)return d[n]=!0,r(t,l,e);o.push(d[n]={feature:t,layer:l,geometry:e,distanceSq:i,callback:r})}};let e;var t=[this.replayGroup_];return this.declutterExecutorGroup&&t.push(this.declutterExecutorGroup),t.some(t=>e=t.forEachFeatureAtCoordinate(i,a,h,s,u,t===this.declutterExecutorGroup&&n.declutterTree?n.declutterTree.all().map(t=>t.value):null)),e}}handleFontsChanged(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(e){const o=this.getLayer(),i=o.getSource();if(!i)return!1;var a=e.viewHints[0],h=e.viewHints[1],l=o.getUpdateWhileAnimating(),d=o.getUpdateWhileInteracting();if(this.ready&&!l&&a||!d&&h)this.animatingOrInteracting_=!0;else{this.animatingOrInteracting_=!1;const n=e.extent,s=e.viewState,_=s.projection,m=s.resolution,p=e.pixelRatio,f=o.getRevision(),r=o.getRenderBuffer();let t=o.getRenderOrder();void 0===t&&(t=Fr);var l=s.center.slice(),a=yt(n,r*m),d=a.slice(),u=[a.slice()],h=_.getExtent();if(i.getWrapX()&&_.canWrapX()&&!Et(h,e.extent)){const e=Y(h),o=Math.max(Y(a)/2,e),i=(a[0]=h[0]-o,a[2]=h[2]+o,xe(l,_),Yt(u[0],_));i[0]<h[0]&&i[2]<h[2]?u.push([i[0]+e,i[1],i[2]+e,i[3]]):i[0]>h[0]&&i[2]>h[2]&&u.push([i[0]-e,i[1],i[2]-e,i[3]])}if(this.ready&&this.renderedResolution_==m&&this.renderedRevision_==f&&this.renderedRenderOrder_==t&&Et(this.wrappedRenderedExtent_,a))gt(this.renderedExtent_,d)||(this.hitDetectionImageData_=null,this.renderedExtent_=d),this.renderedCenter_=l,this.replayGroupChanged=!1;else{this.replayGroup_=null;const v=new pr(.5*m/p,a,m,p);let n;this.getLayer().getDeclutter()&&(n=new pr(.5*m/p,a,m,p));let s;{const o=void 0}for(let t=0,e=u.length;t<e;++t)i.loadFeatures(u[t],m,_);const x=(e=.5*m/p)*e;let r=!0;var c=function(t){let e;var i=t.getStyleFunction()||o.getStyleFunction();if(e=i?i(t,m):e){const o=this.renderFeature(t,x,e,v,s,n);r=r&&!o}}.bind(this),g=i.getFeaturesInExtent(a);t&&g.sort(t);for(let t=0,e=g.length;t<e;++t)c(g[t]);this.renderedFeatures_=g,this.ready=r;h=v.finish(),e=new Ir(a,m,p,i.getOverlaps(),h,o.getRenderBuffer());n&&(this.declutterExecutorGroup=new Ir(a,m,p,i.getOverlaps(),n.finish(),o.getRenderBuffer())),this.renderedResolution_=m,this.renderedRevision_=f,this.renderedRenderOrder_=t,this.renderedExtent_=d,this.wrappedRenderedExtent_=a,this.renderedCenter_=l,this.renderedProjection_=_,this.replayGroup_=e,this.hitDetectionImageData_=null,this.replayGroupChanged=!0}}return!0}renderFeature(i,n,s,r,o,a){if(!s)return!1;let h=!1;if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)h=Lr(r,i,s[t],n,this.boundHandleStyleImageChange_,o,a)||h;else h=Lr(r,i,s,n,this.boundHandleStyleImageChange_,o,a);return h}},kr=class extends rr{constructor(t){super(t)}createRenderer(){return new Pr(this)}},Ar=class{constructor(t){this.rbush_=new Xs(t),this.items_={}}insert(t,e){t={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(t),this.items_[z(e)]=t}load(i,n){var s=new Array(n.length);for(let t=0,e=n.length;t<e;t++){var r=i[t],o=n[t],r={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};s[t]=r,this.items_[z(o)]=r}this.rbush_.load(s)}remove(t){var t=z(t),e=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(e)}update(t,e){var i=this.items_[z(e)];bt([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){t={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(t).map(function(t){return t.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(i,n){let s;for(let t=0,e=i.length;t<e;t++)if(s=n(i[t]))return s;return s}isEmpty(){return D(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){var e=this.rbush_.toJSON();return x(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}},Dr="addfeature",Or="removefeature";function Gr(t,e){return[[-1/0,-1/0,1/0,1/0]]}function zr(c,g){return function(t,e,i,n,s){const r=this;{var o=c,a=g,h=t,l=(t=e,i),d=s||k;const u=new XMLHttpRequest;u.open("GET","function"==typeof o?o(h,t,l):o,!0),"arraybuffer"==a.getType()&&(u.responseType="arraybuffer"),u.withCredentials=!1,u.onload=function(e){if(!u.status||200<=u.status&&u.status<300){const e=a.getType();let t;"json"==e||"text"==e?t=u.responseText:"xml"==e?t=(t=u.responseXML)||(new DOMParser).parseFromString(u.responseText,"application/xml"):"arraybuffer"==e&&(t=u.response),t?(i=a.readFeatures(t,{extent:h,featureProjection:l}),a.readProjection(t),r.addFeatures(i),void 0!==n&&n(i)):d()}else d();var i},u.onerror=d,u.send()}}}class Wr extends t{constructor(t,e,i){super(t),this.feature=e,this.features=i}}const Xr=class extends _{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===t.wrapX||t.wrapX}),this.on,this.once,this.un,this.loader_=k,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(d(this.format_,7),this.loader_=zr(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:Gr;var e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,n;this.featuresRtree_=e?new Ar:null,this.loadedExtentsRtree_=new Ar,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),e||void 0!==i||(i=new l(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=z(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Wr(Dr,t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[r(e,o,this.handleFeatureChange_,this),r(e,I,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;var n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(d(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(i){const n=[],s=[],r=[];for(let t=0,e=i.length;t<e;t++){const r=i[t],l=z(r);this.addToIndex_(l,r)&&s.push(r)}for(let t=0,e=s.length;t<e;t++){var o=s[t],a=z(o),h=(this.setupChangeEvents_(a,o),o.getGeometry());if(h){const i=h.getExtent();n.push(i),r.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(n,r),this.hasListener(Dr))for(let t=0,e=s.length;t<e;t++)this.dispatchEvent(new Wr(Dr,s[t]))}bindFeaturesCollection_(e){let i=!1;this.addEventListener(Dr,function(t){i||(i=!0,e.push(t.feature),i=!1)}),this.addEventListener(Or,function(t){i||(i=!0,e.remove(t.feature),i=!1)}),e.addEventListener(nt,function(t){i||(i=!0,this.addFeature(t.element),i=!1)}.bind(this)),e.addEventListener(st,function(t){i||(i=!0,this.removeFeature(t.element),i=!1)}.bind(this)),this.featuresCollection_=e}clear(t){if(t){for(const t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(a);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const t=function(t){this.removeFeatureInternal(t)}.bind(this);this.featuresRtree_.forEach(t);for(const t in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[t])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};t=new Wr("clear");this.dispatchEvent(t),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(e,i){var t=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(t,function(t){return t.getGeometry().intersectsCoordinate(e)?i(t):void 0})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(e,i){return this.forEachFeatureInExtent(e,function(t){if(t.getGeometry().intersectsExtent(e)){const e=i(t);if(e)return e}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),D(this.nullGeometryFeatures_)||F(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e}getFeaturesInExtent(t,e){return this.featuresRtree_?e&&e.canWrapX()&&this.getWrapX()?(e=function(t,e){if(e.canWrapX()){var i=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[i[0],t[1],i[2],t[3]]];Yt(t,e);e=Y(i);if(Y(t)>e)return[[i[0],t[1],i[2],t[3]]];if(t[0]<i[0])return[[t[0]+e,t[1],i[2],t[3]],[i[0],t[1],t[2],t[3]]];if(t[2]>i[2])return[[t[0],t[1],i[2],t[3]],[i[0],t[1],t[2]-e,t[3]]]}return[t]}(t,e),[].concat(...e.map(t=>this.featuresRtree_.getInExtent(t)))):this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,i){const n=t[0],s=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const h=[-1/0,-1/0,1/0,1/0];return i=i||L,this.featuresRtree_.forEachInExtent(h,function(t){if(i(t)){const i=t.getGeometry(),e=a;if((a=i.closestPointXY(n,s,o,a))<e){r=t;const i=Math.sqrt(a);h[0]=n-i,h[1]=s-i,h[2]=n+i,h[3]=s+i}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){t=this.idIndex_[t.toString()];return void 0!==t?t:null}getFeatureByUid(t){t=this.uidIndex_[t];return void 0!==t?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){var e=t.target,i=z(e),n=e.getGeometry();if(n){const t=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);n=e.getId();if(void 0!==n){const t=n.toString();this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Wr("changefeature",e))}hasFeature(t){var e=t.getId();return void 0!==e?e in this.idIndex_:z(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&D(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,i,n){var s=this.loadedExtentsRtree_,r=this.strategy_(t,i,n);for(let t=0,e=r.length;t<e;++t){const o=r[t];s.forEachInExtent(o,function(t){return Et(t.extent,o)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Wr("featuresloadstart")),this.loader_.call(this,o,i,n,function(t){--this.loadingExtentsCount_,this.dispatchEvent(new Wr("featuresloadend",void 0,t))}.bind(this),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Wr("featuresloaderror"))}.bind(this)),s.insert(o,{extent:o.slice()}))}this.loading=!(this.loader_.length<4)&&0<this.loadingExtentsCount_}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){var t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(t){if(bt(t.extent,e))return i=t,!0}),i&&t.remove(i)}removeFeature(t){var e;t&&((e=z(t))in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t))&&this.changed()}removeFeatureInternal(t){var e=z(t),i=this.featureChangeKeys_[e];if(i)return i.forEach(a),delete this.featureChangeKeys_[e],void 0!==(i=t.getId())&&delete this.idIndex_[i.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Wr(Or,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){d(this.format_,7),this.url_=t,this.setLoader(zr(t,this.format_))}};const Nr=class Qr extends e{constructor(t){super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t&&("function"==typeof t.getSimplifiedGeometry?this.setGeometry(t):this.setProperties(t))}clone(){var t=new Qr(this.hasProperties()?this.getProperties():null),e=(t.setGeometryName(this.getGeometryName()),this.getGeometry());return e&&t.setGeometry(e.clone()),(e=this.getStyle())&&t.setStyle(e),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(a(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=r(t,o,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(e){if("function"==typeof e)return e;{let t;return t=Array.isArray(e)?e:(d("function"==typeof e.getZIndex,41),[e]),function(){return t}}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".bbp-contactmap-element div.contactelement-map").forEach(t=>{e=[t.dataset.lng,t.dataset.lat],Ri();var e=Oi(e,"EPSG:4326","EPSG:3857"),i=new ns({target:t.id,layers:[new Ws({source:new Fs})],view:new y({center:e,zoom:t.dataset.mapzoom}),interactions:ts({mouseWheelZoom:!1})}),t=new kr({source:new Xr,style:new Hs({image:new $s({anchor:[.5,1],src:t.dataset.pinurl})})}),i=(i.addLayer(t),new Nr(new gn(e)));t.getSource().addFeature(i)})})})()})();